(()=>{"use strict";var e={572:function(e,t,r){var i=r(412);class s{on(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.eventMap[e].push({fn:t,once:r})}off(e,t){let r=this.eventMap[e];if(t){for(let e=0;e<r.length;++e)if(t===r[e].fn){r.splice(e,1);break}}else this.eventMap[e]=[]}offAll(){for(let e of Object.keys(this.eventMap))this.eventMap[e]=[]}emit(e){let t=this.eventMap[e];for(let r=t.length-1;r>=0;--r){let i=t[r];i.fn(),i.once&&this.off(e,i.fn)}}hnPlay(){this.emit("play")}hnPause(){this.emit("pause")}hnEnded(){this.stop(),this.emit("ended")}load(){this.audio.load()}play(){this.stop(),this.audio.play().catch(e=>{})}resume(){this.audio.play()}pause(){this.audio.pause()}stop(){this.audio.readyState>0&&(this.audio.pause(),this.audio.currentTime=0)}seek(e){this.audio.currentTime=e/1e3}get paused(){let e=!1;return this.audio.paused&&0!==this.audio.currentTime&&(e=!0),e}get currentTime(){return this.audio.currentTime}get duration(){return this.audio.duration}set volume(e){e<0||e>1||(this.audio.volume=e)}constructor(e){(0,i._)(this,"audio",void 0),(0,i._)(this,"eventMap",void 0),(0,i._)(this,"audioOption",void 0),(0,i._)(this,"bindPlay",void 0),(0,i._)(this,"bindPause",void 0),(0,i._)(this,"bindEnded",void 0),this.audioOption=e,this.audio=new Audio,this.audio.preload="none",this.audio.src=e.src,e.loop&&(this.audio.loop=e.loop),e.volume&&(this.audio.volume=e.volume),e.autoplay&&this.play(),this.eventMap={play:[],pause:[],ended:[]},this.bindPlay=this.hnPlay.bind(this),this.bindPause=this.hnPause.bind(this),this.bindEnded=this.hnEnded.bind(this),this.audio.addEventListener("play",this.bindPlay),this.audio.addEventListener("pause",this.bindPause),this.audio.addEventListener("ended",this.bindEnded)}}let o=new class{add(e){if(Array.isArray(e))for(let t of e)this._add(t);else this._add(e)}_add(e){if(this.isContain(e.id))return;let t=Object.assign({volume:1,loop:!1,ignoreStop:!1,tag:"default"},e),r=new s(t);this.sounds.set(e.id,{sound:r,...t})}get(e){var t;return(null==(t=this.sounds.get(e))?void 0:t.sound)??null}on(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.get(e);s&&s.on(t,r,i)}off(e,t,r){let i=this.get(e);i&&i.off(t,r)}play(e,t){let r=this.get(e);r&&(t&&(this.off(e,"ended"),this.on(e,"ended",t,!0)),r.play())}resume(e){let t=this.get(e);t&&t.resume()}pause(e){let t=this.get(e);t&&t.pause()}stop(e){let t=this.get(e);t&&t.stop()}seek(e,t){let r=this.get(e);r&&r.seek(t)}stopAll(){for(let e of this.sounds.values())e.ignoreStop||"bgm"===e.tag||e.sound.stop()}resumeAll(){for(let e of this.pauseSounds)e.resume();this.pauseSounds=[]}pauseAll(){for(let e of this.sounds.values())e.sound.paused||(e.sound.pause(),this.pauseSounds.push(e.sound))}getPaused(e){let t=this.get(e);return!!t&&t.paused}getDuration(e){let t=-1,r=this.get(e);return r?t=r.duration:t}getCurrentTime(e){let t=-1,r=this.get(e);return r?t=r.currentTime:t}setVolume(e,t){if(t){let r=this.get(t);r&&(r.volume=e)}else for(let t of this.sounds.values())t.sound.volume=e}loadAll(){for(let e of this.sounds.values())e.sound.load()}isContain(e){let t=!1;for(let r of this.sounds.keys())if(e===r){t=!0;break}return t}constructor(){(0,i._)(this,"sounds",new Map),(0,i._)(this,"pauseSounds",[]),this.sounds=new Map,this.pauseSounds=[]}};var n=r(534);function a(e,t){let r=new CustomEvent("MESSAGE",{detail:t});e.dispatchEvent(r)}function l(){let e=new n.UAParser().getDevice();return("mobile"===e.type||"tablet"===e.type)&&("iPhone"===e.model||"iPad"===e.model)}r(736);let u=r.p+"audio/global/button.mp3";window.bound={x:0,y:0,scale:1},window.globalVolume=1,window.getZoomRate=()=>window.bound.scale;var c=r(370);class h{start(){this.resume()}end(){a(window,{message:"FRAME_CALL_END",mc:this.mc}),this.dispose()}dispose(){this.mc&&(this.pause(),this.queue=null)}resume(){this.mc&&(this.mc.addEventListener("tick",this.bindTick),this.mc.visible=!0,this.mc.gotoAndPlay(this.s))}pause(){this.mc&&(this.mc.removeEventListener("tick",this.bindTick),this.mc.stop())}hnTick(){let e,t;if(this.queue){for(let[r,i]of this.queue)if("string"==typeof r&&("end"===r&&this.mc.currentFrame===this.mc.totalFrames-1||this.mc.currentLabel===r)||this.mc.currentFrame===r){e=r,t=i;break}"string"==typeof this.e?this.mc.currentLabel===this.e&&this.end():this.mc.currentFrame===this.e&&this.end(),e&&t&&this.executeQueue(e,t)}}executeQueue(e,t){t(),this.queue&&this.queue.delete(e)}constructor(e,t,r,s){(0,i._)(this,"mc",void 0),(0,i._)(this,"s",void 0),(0,i._)(this,"e",void 0),(0,i._)(this,"queue",void 0),(0,i._)(this,"bindTick",void 0),this.mc=e,this.s=t,this.e=r,this.queue=s,this.queue||(this.queue=new Map),this.bindTick=this.hnTick.bind(this)}}window.createjs=c.Z;class d{getContainer(){if(!this.container)throw Error("Container not initialized");return this.container}init(){let e=Object.keys(window.AdobeAn.compositions)[0],t=window.AdobeAn.compositions[e],r=new c.Z.LoadQueue(!1);r.installPlugin(c.Z.Sound),r.addEventListener("fileload",e=>{this.handleFileLoad(e,t)}),r.addEventListener("complete",e=>{this.handleComplete(e,t)});let i=t.getLibrary();c.Z.MotionGuidePlugin.install();let s=i.properties.manifest;if(l())s.map(e=>{this.args.manifestSrc&&(e.src=this.args.manifestSrc.concat("/",e.src))}),s.length>0?r.loadManifest(s):this.setupComplete(i);else{let e=[];s.map(t=>{this.args.manifestSrc&&(t.src=this.args.manifestSrc.concat("/",t.src)),-1===t.src.indexOf(".mp3")?e.push(t):o.add({id:t.id,src:t.src,tag:this.args.stageContent})}),e.length>0?r.loadManifest(e):this.setupComplete(i)}}handleFileLoad(e,t){let r=t.getImages();(null==e?void 0:e.item.type)==="image"&&(r[e.item.id]=e.result)}handleComplete(e,t){let r=t.getLibrary(),i=t.getSpriteSheet(),s=e.target,o=r.ssMetadata;for(let e=0;e<o.length;e++)i[o[e].name]=new c.Z.SpriteSheet({images:[s.getResult(o[e].name)],frames:o[e].frames});this.setupComplete(r)}setupComplete(e){if(this.lib=e,this.exportRoot=new e[this.args.stageContent],this.exportRoot.name=`exportRoot_${this.args.stageContent}`,this.stage=new e.Stage(this.canvas),c.Z.Touch.enable(this.stage,!0,!1),this.stage.enableMouseOver(),this.addGlobal(),this.canvas&&d.SCALE_UP&&!function(){let e=new n.UAParser().getDevice();return"mobile"===e.type||"tablet"===e.type}()){let e=this.args.canvasSize.w,t=this.args.canvasSize.h;this.canvas.style.width=`${e}px`,this.canvas.style.height=`${t}px`,this.canvas.width=2*e,this.canvas.height=2*t,this.stage.scaleX=2,this.stage.scaleY=2}c.Z.Ticker.framerate=e.properties.fps,c.Z.Ticker.timingMode=c.Z.Ticker.TIMEOUT,c.Z.Ticker.interval=30,c.Z.Ticker.addEventListener("tick",this.stage),this.stage.addChild(this.exportRoot),this.stage.tickEnabled=!1,a(window,{message:d.READY_COMPLETE,self:this}),this.args.autoplay&&this.start()}start(){this.stage.tickEnabled=!0,a(window,{message:d.START,self:this})}pause(){this.stage&&(this.stage.tickEnabled=!1)}resume(){this.stage&&(this.stage.tickEnabled=!0)}addGlobal(){window.playSound=this.playSound.bind(this)}playSound(e,t,r){l()?c.Z.Sound.play(e,{interrupt:c.Z.Sound.INTERRUPT_EARLY,loop:t,offset:r}):o.play(e)}play(e,t,r,i){let s,o="end"===r?e.totalFrames-1:r,n=new Map(i);this.frameCallMap.has(e)?(s=this.frameCallMap.get(e))&&(s.dispose(),s=new h(e,t,o,n),this.frameCallMap.set(e,s),s.start()):(s=new h(e,t,o,n),this.frameCallMap.set(e,s),s.start())}stopPlayQueue(e){for(let[t,r]of this.frameCallMap)t===e&&(r.dispose(),this.frameCallMap.delete(t))}stopAllPlayQueue(){for(let[e,t]of this.frameCallMap)t.dispose(),this.frameCallMap.delete(e)}playOnce(e){return new Promise(t=>{this.play(e,0,"end",[["end",()=>{t()}]])})}playOnceLabelMC(e,t){return new Promise(r=>{if(this.hasLabel(e,t)){e.gotoAndStop(t);let i=this.getChildAt(e,0);this.play(i,0,"end",[["end",()=>{r()}]])}else r()})}lock(){this.exportRoot.mouseEnabled=!1}unlock(){this.exportRoot.mouseEnabled=!0}getRoot(){return this.exportRoot}getLib(){return this.lib}getStage(){return this.stage}getCanvas(){return this.canvas}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?t.getChildByName(e):this.exportRoot.getChildByName(e)}find(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=(t=r||this.exportRoot).getChildByName(e);if(i)return i;{let r=t.children;for(let t=0;t<r.length;++t){let i=r[t];if(i instanceof c.Z.MovieClip){let t=this.find(e,i);if(t)return t}}}}setHitArea(e){let t=e.nominalBounds,r=new c.Z.Shape;r.graphics.beginFill("#ff0000").drawRect(t.x,t.y,t.width,t.height),e.hitArea=r}getBound(e){let t=e.getBounds();return t||(t=e.nominalBounds),t}getNominalBound(e){return e.nominalBounds}hitTest(e,t,r){if(!e.visible||!e.mouseEnabled)return!1;let i=e.globalToLocal(t,r),s=this.getBound(e);return!!(i.x>=0)&&!!(i.x<=s.width)&&!!(i.y>=0)&&!!(i.y<=s.height)}overlap(e,t){let r=this.setupPoint(e),i=this.setupPoint(t);return!(r.tr.y>i.bl.y)&&!(r.bl.y<i.tr.y)&&!(r.tr.x<i.bl.x)&&!(r.bl.x>i.tr.x)}setupPoint(e){let t=this.getBound(e),r={x:e.x-e.regX,y:e.y-e.regY},i=e.parent.localToGlobal(r.x,r.y);return{tr:{x:i.x+t.width,y:i.y},bl:{x:i.x,y:i.y+t.height}}}disableButton(e){e.alpha=.5,e.mouseEnabled=!1}enableButton(e){e.alpha=1,e.mouseEnabled=!0}isClicked(e,t){if(e.name===t)return!0;let r=e.parent;for(;r;){if(r.name===t)return!0;r=r.parent}return!1}alignInY(e){let t=0,r=0,i=0,s=0;for(let o=0;o<e.length;++o)for(let n=o+1;n<e.length;++n)if(t=Math.floor(e[o].x),i=Math.floor(e[o].y),r=Math.floor(e[n].x),i>(s=Math.floor(e[n].y))){let t=e[o];e[o]=e[n],e[n]=t}else if(5>Math.abs(i-s)&&t>r){let t=e[o];e[o]=e[n],e[n]=t}}alignInX(e){let t=0,r=0,i=0,s=0;for(let o=0;o<e.length;++o)for(let n=o+1;n<e.length;++n)if(t=Math.floor(e[o].x),i=Math.floor(e[o].y),r=Math.floor(e[n].x),s=Math.floor(e[n].y),t>r){let t=e[o];e[o]=e[n],e[n]=t}else if(5>Math.abs(t-r)&&i>s){let t=e[o];e[o]=e[n],e[n]=t}}getMovieClipsByName(e,t){let r=[],i=0;for(;;){let s=this.find(`${e}_${i}`,t);if(!s)break;r.push(s),i++}return r.length,r}getChildAt(e,t){return e.getChildAt(t)}hasLabel(e,t){return e.labels.some(e=>e.label===t)}constructor(e){var t;(0,i._)(this,"args",void 0),(0,i._)(this,"doc",document),(0,i._)(this,"container",void 0),(0,i._)(this,"canvas",void 0),(0,i._)(this,"exportRoot",void 0),(0,i._)(this,"stage",void 0),(0,i._)(this,"lib",void 0),(0,i._)(this,"frameCallMap",new Map),this.args=e;let r=this.doc.querySelector(this.args.node);if(!r)throw Error(`Container not found: ${this.args.node}`);this.container=r,this.container.style.width=`${this.args.canvasSize.w}px`,this.container.style.height=`${this.args.canvasSize.h}px`,this.canvas=this.doc.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.width=this.args.canvasSize.w,this.canvas.height=this.args.canvasSize.h,this.container.appendChild(this.canvas),(t=this.args.src,new Promise((e,r)=>{let i=document.createElement("script");i.src=t,i.async=!1,document.body.appendChild(i),i.addEventListener("load",()=>{e()}),i.addEventListener("error",()=>{r(Error(`${t} \u{C2A4}\u{D06C}\u{B9BD}\u{D2B8} \u{B85C}\u{B4DC} \u{C2E4}\u{D328}`))})})).then(()=>{this.init()}),window.addEventListener("MESSAGE",e=>{let t=e.detail;if("FRAME_CALL_END"===t.message){let e=t.mc;for(let[t]of this.frameCallMap)t===e&&this.frameCallMap.delete(t)}})}}(0,i._)(d,"START","ccstart"),(0,i._)(d,"READY_COMPLETE","ccreadycomplete"),(0,i._)(d,"SCALE_UP",!0);class g{init(){this.setupCC(),this.setupEvent()}reset(){}activate(){this.isActive=!0}deactivate(){this.isActive=!1}hnMessage(e){this.isActive&&e.detail.message===d.READY_COMPLETE&&this.initCC()}setupEvent(){this.messageHandler=this.hnMessage.bind(this),window.addEventListener("MESSAGE",this.messageHandler)}setupCC(){this.props.cc&&(this.cc=new d(this.props.cc))}initCC(){this.cc&&this.cc.start()}playButtonAudio(){o.play("button")}constructor(e){(0,i._)(this,"props",void 0),(0,i._)(this,"root",void 0),(0,i._)(this,"cc",void 0),(0,i._)(this,"isActive",!0),(0,i._)(this,"messageHandler",void 0);let{root:t}=e;this.props=e,this.root=document.querySelector(t)}}let p=["ones","tens","hundreds","thousands"];function m(e,t){switch(t){case"ones":return Math.floor(Math.abs(e))%10;case"tens":return Math.floor(Math.abs(e)%100/10);case"hundreds":return Math.floor(Math.abs(e)%1e3/100);case"thousands":return Math.floor(Math.abs(e)/1e3);default:return 0}}function f(e){switch(e){case"ones":return 2;case"tens":return 1;default:return 0}}function C(e,t){let r=Math.max(0,e);if(0!==m(r,t))return!1;let i=function(e){let t=Math.max(0,e);return m(t,"thousands")>0?"thousands":m(t,"hundreds")>0?"hundreds":m(t,"tens")>0?"tens":"ones"}(r);return f(t)<f(i)}function y(e){let t=Math.floor(e/100);return{hundreds:t,tens:Math.floor(e%100/10),ones:e%10}}function w(e){let t=["ones","tens","hundreds"],r=t.indexOf(e);return r>0?t[r-1]:null}function S(e,t,r){return m(e,t)+(r[t]??0)}function b(e,t,r,i,s){let o=m(t,r),n=S(e,r,i);if(s){let e=["ones","tens","hundreds"],t=e.indexOf(r);if(t>0){let r=e[t-1];s.has(r)&&(n=Math.max(0,n-1))}}return n<o}function M(e,t,r){let i=["ones","tens","hundreds"],s=i.indexOf(t);for(let t=s+1;t<i.length;t++){let s=i[t];if(S(e,s,r)>0)return s}return null}function v(e,t,r,i,s){let o=m(e,r),n=m(t,r),a=o+(i[r]??0);if("ones"!==r){let e=["ones","tens","hundreds"],t=e.indexOf(r);if(t>0){let r=e[t-1];s.has(r)&&(a=Math.max(0,a-1))}}return Math.max(0,a-n)}let A=class{show(e,t){this.isAutoCalculating||(this.handEl.style.left=`${e}px`,this.handEl.style.top=`${t}px`,this.handEl.classList.add("show"),this.handEl.classList.remove("clicking"))}async showInitialGuide(e,t){this.show(e,t),await this.sleep(this.config.initialShowDuration),this.hide()}hide(){this.handEl.classList.remove("show")}forceStop(){this.handEl.classList.remove("show"),this.handEl.classList.remove("clicking"),this.isAnimating=!1,this.isAutoCalculating=!0}setAutoCalculating(e){this.isAutoCalculating=e,e&&this.hide()}setAnimationCompleteCallback(e){this.onAnimationComplete=e}async guideTwice(e,t){if(!this.isAutoCalculating&&!this.isAnimating){this.isAnimating=!0,this.show(e,t),await this.sleep(this.config.clickAnimationDelay);for(let e=0;e<2;e++){if(this.isAutoCalculating){this.isAnimating=!1;return}await this.playClickMotion(),e<1&&await this.sleep(this.config.betweenClicksDelay)}this.hide(),this.isAnimating=!1,this.onAnimationComplete&&this.onAnimationComplete()}}async playClickMotion(){if(this.handEl.classList.add("clicking"),await this.sleep(this.config.clickHoldDuration),this.isAutoCalculating)return void this.handEl.classList.remove("clicking");this.handEl.classList.remove("clicking"),await this.sleep(this.config.clickReleaseDelay)}async guideOnce(e,t){if(!this.isAutoCalculating&&!this.isAnimating){if(this.isAnimating=!0,this.show(e,t),await this.sleep(this.config.clickAnimationDelay),this.isAutoCalculating||(await this.playClickMotion(),this.isAutoCalculating)){this.isAnimating=!1;return}this.hide(),this.isAnimating=!1,this.onAnimationComplete&&this.onAnimationComplete()}}async playClickAnimation(e,t){this.show(e,t),await this.sleep(this.config.clickAnimationDelay),await this.playClickMotion(),this.hide()}startAutoGuide(e,t){this.autoGuideX=e,this.autoGuideY=t,this.lastInputTime=Date.now(),this.autoGuideTimer&&clearInterval(this.autoGuideTimer),this.autoGuideTimer=window.setInterval(async()=>{!this.isAutoCalculating&&Date.now()-this.lastInputTime>=5e3&&(await this.guideTwice(this.autoGuideX,this.autoGuideY),this.lastInputTime=Date.now())},1e3),window.addEventListener("pointerdown",this.resetAutoGuideTimer,!0)}stopAutoGuide(){this.autoGuideTimer&&(clearInterval(this.autoGuideTimer),this.autoGuideTimer=null),window.removeEventListener("pointerdown",this.resetAutoGuideTimer,!0),this.forceStop()}sleep(e){return new Promise(t=>setTimeout(t,e))}constructor(e=document.body,t){(0,i._)(this,"handEl",void 0),(0,i._)(this,"autoGuideTimer",null),(0,i._)(this,"lastInputTime",Date.now()),(0,i._)(this,"autoGuideX",0),(0,i._)(this,"autoGuideY",0),(0,i._)(this,"isAnimating",!1),(0,i._)(this,"isAutoCalculating",!1),(0,i._)(this,"onAnimationComplete",null),(0,i._)(this,"config",void 0),(0,i._)(this,"resetAutoGuideTimer",()=>{this.lastInputTime=Date.now()}),this.config={initialShowDuration:1e3,clickAnimationDelay:400,clickHoldDuration:500,clickReleaseDelay:500,betweenClicksDelay:300,...t},this.handEl=document.createElement("div"),this.handEl.className="hand-guide",this.handEl.setAttribute("aria-label","터치 유도"),e.appendChild(this.handEl)}};class x{resetCalcFlags(){this._isAutoCalculating=!1,this._isAnimating=!1,this._isCalculationComplete=!1}get isAnimating(){return this._isAnimating}set isAnimating(e){this._isAnimating=e}get isAutoCalculating(){return this._isAutoCalculating}set isAutoCalculating(e){this._isAutoCalculating=e}get isCalculationComplete(){return this._isCalculationComplete}set isCalculationComplete(e){this._isCalculationComplete=e}get currentStepIndex(){return this._currentStepIndex}set currentStepIndex(e){this._currentStepIndex=e}get isWaitingForBorrow(){return this._isWaitingForBorrow}set isWaitingForBorrow(e){this._isWaitingForBorrow=e}get borrowFromPlace(){return this._borrowFromPlace}set borrowFromPlace(e){this._borrowFromPlace=e}get borrowedPlaces(){return this._borrowedPlaces}get borrowCounts(){return this._borrowCounts}get currentBorrowTarget(){return this._currentBorrowTarget}set currentBorrowTarget(e){this._currentBorrowTarget=e}get isInBorrowProcess(){return this._isInBorrowProcess}set isInBorrowProcess(e){this._isInBorrowProcess=e}startAutoCalc(){this._isAutoCalculating=!0,this._isAnimating=!1,this._isCalculationComplete=!1}finishCalc(){this._isAutoCalculating=!1,this._isAnimating=!1,this._isCalculationComplete=!0}startAnimating(){this._isAnimating=!0}stopAnimating(){this._isAnimating=!1}startBorrowProcess(e){this._isInBorrowProcess=!0,this._isWaitingForBorrow=!0,this._borrowFromPlace=e}endBorrowProcess(){this._isInBorrowProcess=!1,this._isWaitingForBorrow=!1,this._borrowFromPlace=null}resetBorrowState(){this._isWaitingForBorrow=!1,this._borrowFromPlace=null,this._borrowedPlaces.clear(),this._borrowCounts.clear(),this._currentBorrowTarget=null,this._isInBorrowProcess=!1}getBorrowedCountsRecord(){return{ones:this._borrowCounts.get("ones")||0,tens:this._borrowCounts.get("tens")||0,hundreds:this._borrowCounts.get("hundreds")||0,thousands:this._borrowCounts.get("thousands")||0}}setBorrowedCountsFromRecord(e){Object.keys(e).forEach(t=>{let r=e[t]??0;this._borrowCounts.set(t,r)})}snapshotBorrowState(){return{isWaitingForBorrow:this._isWaitingForBorrow,borrowFromPlace:this._borrowFromPlace,borrowedPlaces:new Set(this._borrowedPlaces),borrowCounts:new Map(this._borrowCounts),currentBorrowTarget:this._currentBorrowTarget,isInBorrowProcess:this._isInBorrowProcess}}constructor(){(0,i._)(this,"_isAnimating",!1),(0,i._)(this,"_isAutoCalculating",!1),(0,i._)(this,"_isCalculationComplete",!1),(0,i._)(this,"_currentStepIndex",0),(0,i._)(this,"_isWaitingForBorrow",!1),(0,i._)(this,"_borrowFromPlace",null),(0,i._)(this,"_borrowedPlaces",new Set),(0,i._)(this,"_borrowCounts",new Map),(0,i._)(this,"_currentBorrowTarget",null),(0,i._)(this,"_isInBorrowProcess",!1)}}class P{numBoxFor(e){let t=this.numBoxCache.get(e);if(t&&document.contains(t))return t;let r=document.querySelector(`.num-box[data-place="${e}-result"]`);return r&&this.numBoxCache.set(e,r),r}ensureGroup(e,t,r){let i=e.querySelector(`.num-model-group.group-${t}`);return i||((i=document.createElement("div")).className=`num-model-group group-${t}`,i.setAttribute("data-place",`${r}-${t}`),e.appendChild(i)),i}appendImagesToGroup(e,t,r,i,s){let o=document.createDocumentFragment();for(let e=0;e<r;e++){let r=document.createElement("img");r.src=`./images/${t}`,r.alt=`${s} image ${i+e+1}`,r.className="num-model-img",o.appendChild(r)}e.appendChild(o)}splitGroupsAndDistribute(e,t,r,i,s,o,n){e.querySelectorAll(".num-model-group").forEach(e=>{e.classList.contains("group-left")&&e.remove()});let a=document.createElement("div");a.className="num-model-group group-left",a.setAttribute("data-place",`${r}-left`);let l=document.createElement("div");l.className="num-model-group group-right",l.setAttribute("data-place",`${r}-right`);for(let e=0;e<Math.min(s,10);e++){let r=t[e];a.appendChild(r.cloneNode(!0))}for(let e=10;e<s;e++){let r=t[e];l.appendChild(r.cloneNode(!0))}this.appendImagesToGroup(l,i,o,s,n),e.appendChild(a),e.appendChild(l)}toggleHasBothGroups(e){let t=!!e.querySelector(".group-left"),r=!!e.querySelector(".group-right");e.classList.toggle("has-both-groups",t&&r)}updateNumModelCount(e,t){let r=e.querySelector(".num-model-count");if(r&&r.remove(),0===t)return;let i=document.createElement("div");i.className="num-model-count",i.textContent=String(t),e.appendChild(i)}updateNumModelCountZero(e){let t=e.querySelector(".num-model-count");t&&t.remove();let r=document.createElement("div");r.className="num-model-count",r.textContent="0",e.appendChild(r)}updateSubtractionCount(e,t,r,i){let s=e.querySelector(".num-model-count");if(!(0===r&&i(t))){if(s&&s.remove(),0===r){let t=document.createElement("div");t.className="num-model-count",t.textContent="0",e.appendChild(t);return}this.updateNumModelCount(e,r)}}imageNameForPlace(e){return"ones"===e?"one.png":"tens"===e?"ten.png":"hundreds"===e?"hun.png":"thousand.png"}placeLeftGroupWithValue(e,t,r){let i=this.ensureGroup(e,"left",t);i.innerHTML="";let s=this.imageNameForPlace(t);this.appendImagesToGroup(i,s,r,0,"Number")}appendMerged(e,t,r){let i=this.clearAndEnsureMergedGroup(e),s=this.imageNameForPlace(t),o=document.createDocumentFragment();for(let e=0;e<r;e++){let e=document.createElement("img");e.src=`./images/${s}`,e.className="num-model-img",o.appendChild(e)}i.appendChild(o),"hundreds"===t&&this.stackGroupImagesCentered(i)}appendMergedOnes(e,t){let r=this.clearAndEnsureMergedGroup(e);for(let e=0;e<t;e++){let e=document.createElement("img");e.src="./images/one.png",e.className="num-model-img",r.appendChild(e)}}ensureSideGroupWithValue(e,t,r,i){let s=e.querySelector(`.num-model-group.group-${t}`);s&&s.remove(),s=this.ensureGroup(e,t,r);let o=this.imageNameForPlace(r);this.appendImagesToGroup(s,o,i,0,"Number")}placeLeftGroupForSubtraction(e,t,r){let i=e.querySelector(".num-model-group.group-left");i&&i.remove();let s=document.createElement("div");s.className="num-model-group group-left",s.setAttribute("data-place",`${t}-left`);let o=this.imageNameForPlace(t);for(let e=0;e<r;e++){let t=document.createElement("img");t.src=`./images/${o}`,t.alt=`Number ${r} image ${e+1}`,t.className="num-model-img",s.appendChild(t)}e.appendChild(s)}rebuildBorrowFromBox(e,t,r){e.querySelectorAll(".num-model-group").forEach(e=>e.remove()),e.querySelectorAll(".num-model-img").forEach(e=>e.remove());let i=e.querySelector(".num-model-count");if(i&&i.remove(),r>0){let i=document.createElement("div");i.className="num-model-group group-left",i.setAttribute("data-place",`${t}-left`);let s="tens"===t?"ten.png":"hun.png";for(let e=0;e<r;e++){let e=document.createElement("img");e.src=`./images/${s}`,e.className="num-model-img",i.appendChild(e)}e.appendChild(i),this.updateNumModelCount(e,r)}else this.updateNumModelCountZero(e)}removeEmptyGroups(e){e.querySelectorAll(".num-model-group").forEach(e=>{0===e.querySelectorAll("img.num-model-img").length&&e.remove()})}clearAllGroupsAndImages(e){e.querySelectorAll("img.num-model-img").forEach(e=>e.remove()),this.removeEmptyGroups(e)}stackGroupImagesCentered(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=e.querySelectorAll("img"),s=i.length,o=(s-1)/2;i.forEach((e,i)=>{e.style.zIndex=String(s-i),e.style.transform=`translate(-50%, -50%) translate(${(i-o)*t}px, ${-((i-o)*r)}px)`})}getGroup(e,t){let r="merged"===t?".group-merged":`.group-${t}`;return e.querySelector(r)}countImagesIn(e){return e?e.querySelectorAll("img").length:0}removeGroup(e){e&&e.parentElement&&e.parentElement.removeChild(e)}setMergedOnly(e,t){e.classList.toggle("merged-only",t)}removeMergedOnly(e){e.classList.remove("merged-only")}resetNumBox(e){e.innerHTML="",e.classList.remove("merged-only","has-both-groups","active")}clearAndEnsureMergedGroup(e){let t=this.getGroup(e,"merged");return t||((t=document.createElement("div")).className="num-model-group group-merged",e.appendChild(t)),t.innerHTML="",t}countCarryInMerged(e,t){let r=this.getGroup(e,"merged");return r?r.querySelectorAll(`img[src$="${t}"]`).length:0}prepareMergedFromVisible(e){let t=this.clearAndEnsureMergedGroup(e);return e.querySelectorAll(".num-model-group").forEach(e=>{e.classList.contains("group-merged")||(e.querySelectorAll("img").forEach(e=>{"0"!==e.style.opacity&&(t.appendChild(e),e.style.opacity="1",e.style.transition="none")}),e.remove())}),t}prepareMergedAndAppend(e,t){e.innerHTML="";let r=document.createElement("div");r.className="num-model-group group-merged",e.appendChild(r),t.forEach(e=>r.appendChild(e))}removeAllCarryGroups(){document.querySelectorAll(".ten-carry-group, .hun-carry-group, .thou-carry-group").forEach(e=>e.remove())}createCarryGroupLeft(e,t,r,i){let s=document.createElement("div");s.className=`num-model-group group-left ${t}-carry-group`,e.insertBefore(s,e.firstChild);for(let e=0;e<i;e++){let e=document.createElement("img");e.src=`./images/${r}`,e.className=`num-model-img ${t}-carry`,s.appendChild(e)}return s}constructor(){(0,i._)(this,"numBoxCache",new Map)}}function k(e,t){let r=e.src;r.includes("one.png")?e.src=r.replace("one.png","one_r.png"):r.includes("ten.png")?e.src=r.replace("ten.png","ten_r.png"):r.includes("hun.png")?e.src=r.replace("hun.png","hun_r.png"):r.includes("thousand.png")&&(e.src=r.replace("thousand.png","thousand_r.png"))}function B(e,t,r,i){let s=e.querySelectorAll(".num-model-group"),o=[];s.forEach(e=>{e.querySelectorAll("img").forEach(e=>{e instanceof HTMLImageElement&&o.push(e)})});let n=[],a=o.length,l="tens"===t||"ones"===t||"hundreds"===t;for(let e=0;e<r;e++){let r=o[l?a-1-e:e];r&&(k(r,t),n.push(r))}let u=i?600:1e3,c=i?.8:1.2;return i&&"tens"===t&&(u=350,c=.6),new Promise(e=>{setTimeout(()=>{n.forEach(e=>{e.style.transition=`opacity ${c}s ease-out`,e.style.opacity="0"}),setTimeout(e,1e3*c)},u)})}class E{showCalculationResultPopup(e){let t=`
      <div class="calculation-result-popup">
        <div class="calculation-result-backdrop"></div>
        <div class="calculation-result-content">
          <div class="calculation-result-formula">${e}</div>
        </div>
      </div>
    `;(document.querySelector("#wrap")||document.body).insertAdjacentHTML("beforeend",t);let r=document.querySelector(".calculation-result-popup");if(!r)return;r.style.display="flex",r.style.opacity="0",setTimeout(()=>{r&&(r.style.opacity="1")},10);let i=e=>{"Escape"===e.key&&(this.closeCalculationResultPopup(),document.removeEventListener("keydown",i))};document.addEventListener("keydown",i)}closeCalculationResultPopup(){let e=document.querySelector(".calculation-result-popup");e&&(e.style.opacity="0",setTimeout(()=>{e&&e.parentNode&&e.parentNode.removeChild(e)},300))}}class N{setEventHandlers(e,t,r){this.onWrongClick=e,this.onCorrectClick=t,this.onAutoGuide=r}start(e){this.state.isActive||(this.state.isActive=!0,this.state.wrongClickCount=0,this.state.lastInputTime=Date.now(),this.clickListener=e=>this.handleClick(e),e.addEventListener("click",this.clickListener,!0),this.startAutoGuideTimer())}stop(){if(this.state.isActive=!1,this.clickListener){document.removeEventListener("click",this.clickListener,!0),document.removeEventListener("click",this.clickListener);let e=document.querySelector(".result-screen");e&&(e.removeEventListener("click",this.clickListener,!0),e.removeEventListener("click",this.clickListener)),document.querySelectorAll(".container, .main-layout, .result-screen").forEach(e=>{e.removeEventListener("click",this.clickListener,!0),e.removeEventListener("click",this.clickListener)}),this.clickListener=null}this.stopAutoGuideTimer()}handleClick(e){let t=e.target;for(let e of this.config.excludeSelectors)if(t.closest(e))return;let r=!1;if(document.querySelector(".expected-target"))r=!!t.closest(".expected-target");else for(let e of this.config.correctSelectors)if(t.closest(e)){r=!0;break}r?this.handleCorrectClick():this.handleWrongClick()}handleCorrectClick(){this.state.wrongClickCount=0,this.state.lastInputTime=Date.now(),this.onCorrectClick&&this.onCorrectClick(),this.restartAutoGuideTimer()}handleWrongClick(){this.state.wrongClickCount++,this.state.lastInputTime=Date.now(),this.state.wrongClickCount>=this.config.wrongClickThreshold&&(this.onWrongClick&&this.onWrongClick(),this.state.wrongClickCount=0)}startAutoGuideTimer(){this.stopAutoGuideTimer(),this.autoGuideTimeout=setTimeout(()=>{this.onAutoGuide&&this.onAutoGuide(),this.state.lastInputTime=Date.now()},this.config.autoGuideDelay)}reportWrongClick(){this.state.wrongClickCount++,this.state.lastInputTime=Date.now(),this.state.wrongClickCount>=this.config.wrongClickThreshold&&(this.onWrongClick&&this.onWrongClick(),this.state.wrongClickCount=0)}stopAutoGuideTimer(){this.autoGuideTimeout&&(clearTimeout(this.autoGuideTimeout),this.autoGuideTimeout=null)}restartAutoGuideTimer(){this.startAutoGuideTimer()}pause(){this.state.isActive=!1,this.stopAutoGuideTimer()}resume(){this.state.isActive=!0,this.restartAutoGuideTimer()}reset(){this.state.wrongClickCount=0,this.state.lastInputTime=Date.now(),this.restartAutoGuideTimer()}disable(){if(this.state.isActive=!1,this.state.wrongClickCount=0,this.stopAutoGuideTimer(),this.clickListener){document.removeEventListener("click",this.clickListener,!0),document.removeEventListener("click",this.clickListener);let e=document.querySelector(".result-screen");e&&(e.removeEventListener("click",this.clickListener,!0),e.removeEventListener("click",this.clickListener)),this.clickListener=null}}getState(){return{...this.state}}constructor(e){(0,i._)(this,"config",void 0),(0,i._)(this,"state",void 0),(0,i._)(this,"onWrongClick",null),(0,i._)(this,"onCorrectClick",null),(0,i._)(this,"onAutoGuide",null),(0,i._)(this,"autoGuideTimeout",null),(0,i._)(this,"clickListener",null),this.config=e,this.state={wrongClickCount:0,lastInputTime:Date.now(),isActive:!1}}}class T{showBorrowUI(e){var t;if("ones"===e)return;let r=document.querySelector(`.num-box[data-place="${e}-result"]`);if(!r)return;r.querySelectorAll(".borrowable").forEach(e=>{var t;e.classList.remove("borrowable");let r=e.cloneNode(!0);null==(t=e.parentNode)||t.replaceChild(r,e)});let i=null,s=r.querySelector(".num-model-group.group-left");if(s){let e=s.querySelectorAll(".num-model-img");e&&e.length>0&&(i=e)}if(!i&&(s=r.querySelector(".num-model-group.group-right"))){let e=s.querySelectorAll(".num-model-img");e&&e.length>0&&(i=e)}if(!i||0===i.length)return;let o=i[0];if(!o||!o.parentNode)return;let n=o.cloneNode(!0);n.classList.add("borrowable"),null==(t=o.parentNode)||t.replaceChild(n,o),n.classList.add("borrowable-highlight"),setTimeout(()=>n.classList.remove("borrowable-highlight"),1e3),n.addEventListener("click",()=>this.config.onBorrowImageClick(e,n),{once:!0})}constructor(e){(0,i._)(this,"config",void 0),this.config=e}}var q=r(450);class I{init(){this.createPickerButtons(),this.setupNumberPicker(),this.setupOperatorButtons(),this.setupActionButtons()}setupOperatorButtons(){document.querySelectorAll(".operator").forEach(e=>{e.addEventListener("click",()=>{let t=e.getAttribute("data-op"),r="+"===t||"-"===t?t:"+";this.selectedOperator===r&&this.operatorToggleState?this.deselectOperator():this.selectOperator(r)})})}selectOperator(e){this.selectedOperator=e,this.operatorToggleState=!0,document.querySelectorAll(".operator").forEach(t=>{t.classList.remove("active"),t.getAttribute("data-op")!==e?t.style.display="none":t.style.display=""});let t=document.querySelector(`[data-op="${e}"]`);t&&t.classList.add("active"),this.config.onOperatorChange&&this.config.onOperatorChange(e)}deselectOperator(){this.selectedOperator="",this.operatorToggleState=!1,document.querySelectorAll(".operator").forEach(e=>{e.classList.remove("active"),e.style.display=""}),this.config.onOperatorChange&&this.config.onOperatorChange("")}setupActionButtons(){let e=document.querySelector(".btn-primary");e&&e.addEventListener("click",()=>{this.config.onCalculate&&this.config.onCalculate()});let t=document.querySelector(".btn-reset");t&&t.addEventListener("click",()=>{this.config.onReset&&this.config.onReset()})}createPickerButtons(){document.querySelectorAll(".picker-list").forEach(e=>{["1","2","3","4","5","6","7","8","9","0"].forEach(t=>{let r=document.createElement("div");r.className="picker-btn",r.textContent=t,e.appendChild(r)})})}setupNumberPicker(){document.querySelectorAll(".digit-box").forEach(e=>{e.addEventListener("click",t=>{let r=t.target;if(r.closest(".picker-btn")||r.closest(".inline-picker")||this.isAutoOpening&&t.isTrusted)return;let i=e.querySelector(".inline-picker"),s=i.querySelectorAll(".picker-btn"),o=e.querySelector(".digit-display"),n=o.getAttribute("data-place");document.querySelectorAll(".inline-picker").forEach(e=>{if(e!==i){let t=e.classList.contains("active"),r=e.querySelectorAll(".picker-btn");this.closePicker(e,r);let i=e.parentElement.querySelector(".digit-display");i&&setTimeout(()=>{if(i.classList.remove("hide"),i.style.opacity="1",i.style.pointerEvents="auto",t){let e=i.getAttribute("data-place");if(e){let t=parseInt(i.textContent||"0",10)||0;this.placeImages(e,t,!1)}}},200)}}),i.classList.contains("active")||(this.hideDigitDisplayAndImages(o,n),setTimeout(()=>{this.openPicker(i,s)},200))})}),document.querySelectorAll(".picker-btn").forEach(e=>{e.addEventListener("click",t=>{if(t.stopPropagation(),this.isAutoOpening)return;let r=e.textContent??"0",i=e.closest(".inline-picker"),s=i.parentElement.querySelector(".digit-display"),o=i.querySelectorAll(".picker-btn");s.textContent=r,s.classList.add("selected"),s.classList.remove("hide"),s.style.opacity="1",s.style.pointerEvents="auto",this.closePicker(i,o),setTimeout(()=>{let e=s.getAttribute("data-place");e&&this.config.onPlaceImages&&this.config.onPlaceImages(e,parseInt(r),!1);let t=null,i="";"hundreds-left"===e?(t=document.querySelector('.digit-display[data-place="tens-left"]'),i="hundreds-left"):"tens-left"===e?(t=document.querySelector('.digit-display[data-place="ones-left"]'),i="tens-left"):"hundreds-right"===e?(t=document.querySelector('.digit-display[data-place="tens-right"]'),i="hundreds-right"):"tens-right"===e&&(t=document.querySelector('.digit-display[data-place="ones-right"]'),i="tens-right"),t&&i&&!this.autoOpened[i]&&("0"!==(t.textContent||"0")||t.classList.contains("selected")||(this.autoOpened[i]=!0,this.isAutoOpening=!0,setTimeout(()=>{let e=t.closest(".digit-box");e&&e.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0})),setTimeout(()=>{this.isAutoOpening=!1},700)},350)))},300)})})}openPicker(e,t){e.classList.add("active"),t.forEach(e=>{e.style.opacity="0",e.style.transform="translateX(20px)"}),q.ZP.to(t,{x:0,opacity:1,duration:.4,ease:"power2.out",stagger:.03})}closePicker(e,t){t?q.ZP.to(t,{x:20,opacity:0,duration:.3,ease:"power2.in",stagger:.02,onComplete:()=>{e.classList.remove("active")}}):e.classList.remove("active")}hideDigitDisplayAndImages(e,t){if(t){var r;let t=null==(r=e.parentElement)?void 0:r.querySelector(".image-container");if(t){let r=t.querySelectorAll("img");if(r.length>0){let i=[e,...Array.from(r)];q.ZP.to(i,{opacity:0,duration:.15,ease:"power2.in",onComplete:()=>{t.innerHTML="",e.classList.add("hide")}})}else q.ZP.to(e,{opacity:0,duration:.15,ease:"power2.in",onComplete:()=>{e.classList.add("hide")}})}else q.ZP.to(e,{opacity:0,duration:.15,ease:"power2.in",onComplete:()=>{e.classList.add("hide")}})}else q.ZP.to(e,{opacity:0,duration:.15,ease:"power2.in",onComplete:()=>{e.classList.add("hide")}})}hideImages(e){var t;let r=document.querySelector(`[data-place="${e}"]`);if(!r)return;let i=null==(t=r.parentElement)?void 0:t.querySelector(".image-container");if(!i)return;let s=i.querySelectorAll("img");s.length>0&&q.ZP.to(s,{opacity:0,duration:.2,ease:"power2.in",onComplete:()=>{i.innerHTML=""}})}placeImages(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=null;if(r){let t=document.querySelector(".result-screen");t&&(i=t.querySelector(`.image-container[data-place="${e}"]`))}else{let t=document.querySelector(".container");if(t&&(i=t.querySelector(`.image-container[data-place="${e}"]`)),!i){let t=document.querySelector(`[data-place="${e}"]`);t&&t.parentElement&&(i=t.parentElement.querySelector(".image-container"))}}if(!i||(i.innerHTML="",0===t))return;let s="";e.includes("hundreds")?s="./images/hun.png":e.includes("tens")?s="./images/ten.png":e.includes("ones")&&(s="./images/one.png");let o=null;r&&e.includes("hundreds")&&((o=document.createElement("div")).className="images-inner",i.appendChild(o));let n=o||i,a=[];for(let e=0;e<t;e++){let i=document.createElement("img");i.src=s,i.alt=`Number ${t} image ${e+1}`,r?i.style.opacity="1":i.style.opacity="0",n.appendChild(i),a.push(i),i.onerror=()=>{i.style.display="none"}}let l=0,u=a.length;a.forEach(t=>{t.onload=()=>{if(++l===u){if(e.includes("hundreds")){let e=(u-1)/2;o?a.forEach((t,r)=>{t.style.position="absolute",t.style.width="100px",t.style.height="100px",t.style.left=`calc(50% + ${(r-e)*8}px - 50px)`,t.style.top=`calc(50% - ${(r-e)*8}px - 50px)`,t.style.transform="none",t.style.zIndex=String(u-r)}):a.forEach((t,r)=>{t.style.position="absolute",t.style.width="100px",t.style.height="100px",t.style.left=`calc(50% + ${(r-e)*8}px - 50px)`,t.style.top=`calc(50% - ${(r-e)*8}px - 50px)`,t.style.transform="none",t.style.zIndex=String(u-r)})}r?a.forEach(e=>{e.style.opacity="1"}):q.ZP.to(a,{opacity:1,duration:.3,ease:"power2.out"})}}})}resetInputScreen(){document.querySelectorAll(".digit-display").forEach(e=>{e.textContent="0"}),document.querySelectorAll(".image-container").forEach(e=>{e.innerHTML=""}),this.selectedOperator="",this.operatorToggleState=!1,document.querySelectorAll(".operator").forEach(e=>{e.classList.remove("active"),e.style.display=""}),document.querySelectorAll(".inline-picker.active").forEach(e=>{e.classList.remove("active"),e.style.opacity="0",e.style.pointerEvents="none",e.querySelectorAll(".picker-btn").forEach(e=>{e.style.opacity="0",e.style.transform="translateX(20px)"})}),document.querySelectorAll(".inline-picker").forEach(e=>{e.style.removeProperty("opacity"),e.style.removeProperty("pointer-events")}),document.querySelectorAll(".digit-display").forEach(e=>{e.classList.remove("hide"),e.classList.remove("selected"),e.style.opacity="1",e.style.pointerEvents="auto"}),this.isAutoOpening=!1,this.autoOpened={"hundreds-left":!1,"tens-left":!1,"hundreds-right":!1,"tens-right":!1}}getNumberFromDisplays(e){var t,r,i;let s=(null==(t=document.querySelector(`[data-place="hundreds-${e}"]`))?void 0:t.textContent)||"0",o=(null==(r=document.querySelector(`[data-place="tens-${e}"]`))?void 0:r.textContent)||"0",n=(null==(i=document.querySelector(`[data-place="ones-${e}"]`))?void 0:i.textContent)||"0";return 100*parseInt(s)+10*parseInt(o)+parseInt(n)}isNumberEmpty(e){var t,r,i;let s=(null==(t=document.querySelector(`[data-place="hundreds-${e}"]`))?void 0:t.textContent)||"";return[s,(null==(r=document.querySelector(`[data-place="tens-${e}"]`))?void 0:r.textContent)||"",(null==(i=document.querySelector(`[data-place="ones-${e}"]`))?void 0:i.textContent)||""].every(e=>!e||""===e.trim()||"0"===e)}getSelectedOperator(){return this.selectedOperator}getOperatorToggleState(){return this.operatorToggleState}constructor(e={}){(0,i._)(this,"selectedOperator",""),(0,i._)(this,"operatorToggleState",!1),(0,i._)(this,"isAutoOpening",!1),(0,i._)(this,"autoOpened",{"hundreds-left":!1,"tens-left":!1,"hundreds-right":!1,"tens-right":!1}),(0,i._)(this,"config",void 0),this.config=e}}class F{calculate(e,t,r){let i,s,o=this.validateInput(e,t,r);if(!o.isValid)return o;switch(r){case"+":default:i=e+t,s="덧셈";break;case"-":i=e-t,s="뺄셈"}return{result:i,operationText:s,isValid:!0}}validateInput(e,t,r){let i=this.isNumberEmpty(e),s=this.isNumberEmpty(t),o=!!r;if(i&&s&&!o)return{result:0,operationText:"",isValid:!1,errorMessage:"문제를 입력하세요"};if((!i||!s)&&!o)return{result:0,operationText:"",isValid:!1,errorMessage:"연산자를 선택하세요"};if(i&&s&&o)return{result:0,operationText:"",isValid:!1,errorMessage:"숫자를 입력하세요"};if("-"===r&&this.getActualInputNumber("left")<this.getActualInputNumber("right"))return{result:0,operationText:"",isValid:!1,errorMessage:"빼는 수가 더 작아야 합니다"};return{result:0,operationText:"",isValid:!0}}isNumberEmpty(e){return 0===e}getActualInputNumber(e){var t,r,i,s,o,n;if(!this.config.inputManager)return 0;let a=(null==(t=document.querySelector(`[data-place="hundreds-${e}"]`))?void 0:t.textContent)||"0",l=(null==(r=document.querySelector(`[data-place="tens-${e}"]`))?void 0:r.textContent)||"0",u=(null==(i=document.querySelector(`[data-place="ones-${e}"]`))?void 0:i.textContent)||"0",c=null==(s=document.querySelector(`[data-place="hundreds-${e}"]`))?void 0:s.classList.contains("selected"),h=null==(o=document.querySelector(`[data-place="tens-${e}"]`))?void 0:o.classList.contains("selected"),d=null==(n=document.querySelector(`[data-place="ones-${e}"]`))?void 0:n.classList.contains("selected"),g=c?parseInt(a):0;return 100*g+10*(h?parseInt(l):0)+(d?parseInt(u):0)}getCalculationResult(e,t,r){switch(r){case"+":default:return e+t;case"-":return e-t}}getMaxCalculationPlace(e,t,r){let i="ones";(e%10>0||t%10>0)&&(i="ones");let s=Math.floor(t%100/10);(Math.floor(e%100/10)>0||s>0)&&(i="tens");let o=Math.floor(e/100),n=Math.floor(t/100);(o>0||n>0)&&(i="hundreds");let a=Math.floor(t/1e3);return(Math.floor(e/1e3)>0||a>0||o>0&&n>0&&o+n>=10)&&(i="thousands"),"-"===r&&"thousands"===i&&(i="hundreds"),i}splitNumberByPlaces(e){return y(e)}calculateCarry(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e+t+r,s=Math.floor(i/10);return{result:i%10,carryOut:s}}calculateBorrow(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e-t-r,s=0;return i<0&&(i+=10,s=1),{result:i,borrowOut:s}}constructor(e={}){(0,i._)(this,"config",void 0),this.config=e}}class G{animateNumberModels(e,t,r,i){this.currentAnimation&&this.currentAnimation.kill();let s=q.ZP.timeline({onComplete:()=>{this.currentAnimation=null,i&&i(),this.config.onAnimationComplete&&this.config.onAnimationComplete()}});this.currentAnimation=s,"+"===r?this.animateAddition(e,t,s):"-"===r&&this.animateSubtraction(e,t,s)}animateAddition(e,t,r){r.add(()=>{this.showNumberModels("left",e)},0),r.add(()=>{this.showOperator("+")},.5),r.add(()=>{this.showNumberModels("right",t)},1),r.add(()=>{this.animateCalculationProcess(e,t,"+")},1.5)}animateSubtraction(e,t,r){r.add(()=>{this.showNumberModels("left",e)},0),r.add(()=>{this.showOperator("-")},.5),r.add(()=>{this.showNumberModels("right",t)},1),r.add(()=>{this.animateCalculationProcess(e,t,"-")},1.5)}showNumberModels(e,t){let r=y(t);r.hundreds>0&&this.placeImages(`hundreds-${e}`,r.hundreds,!0),r.tens>0&&this.placeImages(`tens-${e}`,r.tens,!0),r.ones>0&&this.placeImages(`ones-${e}`,r.ones,!0)}showOperator(e){let t=document.querySelector(".operator-display");t&&(t.textContent=e,q.ZP.fromTo(t,{opacity:0,scale:.5},{opacity:1,scale:1,duration:.3,ease:"back.out(1.7)"}))}animateCalculationProcess(e,t,r){let i=y("+"===r?e+t:e-t);i.hundreds>0&&this.animateResultPlace("hundreds-result",i.hundreds,0),i.tens>0&&this.animateResultPlace("tens-result",i.tens,.2),i.ones>0&&this.animateResultPlace("ones-result",i.ones,.4)}animateResultPlace(e,t,r){let i=setTimeout(()=>{this.placeImages(e,t,!0);let r=document.querySelector(`[data-place="${e}"]`);r&&q.ZP.fromTo(r,{opacity:0,scale:.5},{opacity:1,scale:1,duration:.3,ease:"back.out(1.7)"})},1e3*r);this.timeouts.push(i)}animateCarry(e,t){let r=document.querySelector(`.carry-indicator[data-from="${e}"][data-to="${t}"]`);r&&q.ZP.fromTo(r,{opacity:0,y:-20},{opacity:1,y:0,duration:.3,ease:"power2.out"})}animateBorrow(e,t){let r=document.querySelector(`.borrow-indicator[data-from="${e}"][data-to="${t}"]`);r&&q.ZP.fromTo(r,{opacity:0,y:20},{opacity:1,y:0,duration:.3,ease:"power2.out"})}animateModelMovement(e,t,r){let i=document.querySelector(`.image-container[data-place="${e}"]`),s=document.querySelector(`.image-container[data-place="${t}"]`);if(!i||!s)return;let o=i.querySelectorAll("img");if(0===o.length)return;let n=o[0],a=i.getBoundingClientRect(),l=s.getBoundingClientRect(),u=n.cloneNode(!0);u.style.position="fixed",u.style.left=`${a.left}px`,u.style.top=`${a.top}px`,u.style.zIndex="9999",document.body.appendChild(u),q.ZP.to(u,{x:l.left-a.left,y:l.top-a.top,duration:.5,ease:"power2.inOut",onComplete:()=>{document.body.removeChild(u),r&&r()}}),n.remove()}animateHighlight(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3;q.ZP.fromTo(e,{backgroundColor:"rgba(255, 255, 0, 0.3)"},{backgroundColor:"transparent",duration:t,ease:"power2.out"})}fadeIn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3;q.ZP.fromTo(e,{opacity:0},{opacity:1,duration:t,ease:"power2.out"})}fadeOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,r=arguments.length>2?arguments[2]:void 0;q.ZP.fromTo(e,{opacity:1},{opacity:0,duration:t,ease:"power2.in",onComplete:()=>{r&&r()}})}scaleAnimation(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;q.ZP.to(e,{scale:t,duration:r,ease:"back.out(1.7)"})}stopCurrentAnimation(){this.currentAnimation&&(this.currentAnimation.kill(),this.currentAnimation=null)}stopAllAnimations(){q.ZP.killTweensOf("*"),this.currentAnimation=null,this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts=[]}placeImages(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=null;if(r){let t=document.querySelector(".result-screen");t&&(i=t.querySelector(`.image-container[data-place="${e}"]`))}else{let t=document.querySelector(".container");if(t&&(i=t.querySelector(`.image-container[data-place="${e}"]`)),!i){let t=document.querySelector(`[data-place="${e}"]`);t&&t.parentElement&&(i=t.parentElement.querySelector(".image-container"))}}if(!i||(i.innerHTML="",0===t))return;let s="";e.includes("hundreds")?s="./images/hun.png":e.includes("tens")?s="./images/ten.png":e.includes("ones")&&(s="./images/one.png");let o=null;r&&e.includes("hundreds")&&((o=document.createElement("div")).className="images-inner",i.appendChild(o));let n=o||i,a=[];for(let e=0;e<t;e++){let i=document.createElement("img");i.src=s,i.alt=`Number ${t} image ${e+1}`,r?i.style.opacity="1":i.style.opacity="0",n.appendChild(i),a.push(i),i.onerror=()=>{i.style.display="none"}}let l=0,u=a.length;a.forEach(t=>{t.onload=()=>{if(++l===u){if(e.includes("hundreds")){let e=(u-1)/2;o?a.forEach((t,r)=>{t.style.position="absolute",t.style.width="100px",t.style.height="100px",t.style.left=`calc(50% + ${(r-e)*8}px - 50px)`,t.style.top=`calc(50% - ${(r-e)*8}px - 50px)`,t.style.transform="none",t.style.zIndex=String(u-r)}):a.forEach((t,r)=>{t.style.position="absolute",t.style.width="100px",t.style.height="100px",t.style.left=`calc(50% + ${(r-e)*8}px - 50px)`,t.style.top=`calc(50% - ${(r-e)*8}px - 50px)`,t.style.transform="none",t.style.zIndex=String(u-r)})}r?a.forEach(e=>e.style.opacity="1"):q.ZP.to(a,{opacity:1,duration:.3,ease:"power2.out"})}}})}constructor(e={}){(0,i._)(this,"config",void 0),(0,i._)(this,"currentAnimation",null),(0,i._)(this,"timeouts",[]),this.config=e}}class _{getProgressState(){return{...this.progressState}}getCurrentPlace(){return this.progressState.currentPlace}setCurrentPlace(e){this.progressState.currentPlace=e,this.config.onPlaceChange&&this.config.onPlaceChange(e)}setClickedState(e,t,r){this.progressState.clicked[e][t]=r,this.config.onStateChange&&this.config.onStateChange(this.getProgressState())}resetClickedStates(){this.progressState.clicked={ones:{left:!1,right:!1},tens:{left:!1,right:!1},hundreds:{left:!1,right:!1},thousands:{left:!1,right:!1}},this.config.onStateChange&&this.config.onStateChange(this.getProgressState())}resetProgressState(){this.progressState={currentPlace:"ones",clicked:{ones:{left:!1,right:!1},tens:{left:!1,right:!1},hundreds:{left:!1,right:!1},thousands:{left:!1,right:!1}}},this.config.onStateChange&&this.config.onStateChange(this.getProgressState())}getNextPlace(e){let t=p.indexOf(e);return t<p.length-1?p[t+1]:null}highlightCurrentNumBox(){this.clearAllHighlights();let e=this.progressState.currentPlace;document.querySelectorAll(`.num-box[data-place="${e}-result"]`).forEach(e=>{e.classList.add("active")}),this.updateDigitResultBoxesHighlight()}clearAllHighlights(){document.querySelectorAll(".num-box").forEach(e=>{e.classList.remove("active")})}updateDigitResultBoxesHighlight(){let e=Array.from(document.querySelectorAll(".digit-result-box"));if(0===e.length)return;let t=this.getNextGuideDigitBox();t&&e.forEach(e=>{e===t?e.classList.remove("inactive"):e.classList.add("inactive")})}setActiveDigitResultBox(e){if(!e)return;let t=Array.from(document.querySelectorAll(".digit-result-box"));0!==t.length&&t.forEach(t=>{t===e?t.classList.remove("inactive"):t.classList.add("inactive")})}deactivateAllDigitResultBoxesHighlight(){document.querySelectorAll(".digit-result-box").forEach(e=>{e.classList.add("inactive")})}showInputScreen(){let e=document.querySelector(".main-layout");e&&(e.style.visibility="visible");let t=document.querySelector(".container");t&&(t.style.visibility="visible");let r=document.querySelector(".result-screen");r&&(r.style.visibility="hidden")}showModal(e){let t=document.querySelector("#global-modal"),r=document.querySelector(".global-modal-message");if(t&&r){r.textContent=e,t.style.display="flex";let i=t.querySelector(".global-modal-close");if(i){let e=()=>{this.hideModal(),i.removeEventListener("click",e)};i.addEventListener("click",e)}let s=e=>{"Escape"===e.key&&(this.hideModal(),document.removeEventListener("keydown",s))};document.addEventListener("keydown",s)}}hideModal(){let e=document.querySelector("#global-modal");e&&(e.style.display="none")}setButtonState(e,t){let r=document.querySelector(e);r&&(t?r.classList.add("active"):r.classList.remove("active"))}setButtonEnabled(e,t){let r=document.querySelector(e);r&&(r.style.pointerEvents=t?"auto":"none",r.style.opacity=t?"1":"0.5")}setupResultScreenButtons(){let e=document.querySelector(".btn-auto-calc");e&&e.addEventListener("click",()=>{this.setButtonState(".btn-auto-calc",!0)});let t=document.querySelector(".btn-home");t&&t.addEventListener("click",()=>{this.showInputScreen()});let r=document.querySelector(".btn-result-reset");r&&r.addEventListener("click",()=>{this.setButtonState(".btn-result-reset",!0)})}bindResultScreenButtons(e){let{onAutoCalc:t,onReset:r,onHome:i}=e,s=document.querySelector(".btn-auto-calc");s&&t&&s.addEventListener("click",()=>t());let o=document.querySelector(".btn-result-reset");o&&r&&o.addEventListener("click",()=>r());let n=document.querySelector(".btn-home");n&&i&&n.addEventListener("click",()=>i())}setAutoCalcButtonState(e){let t=document.querySelector(".btn-auto-calc");t&&(e?t.classList.add("calculating"):t.classList.remove("calculating"))}getCurrentPlaceDigitBox(){let e=this.progressState.currentPlace,t=this.getProgressState();if(t.clicked[e].left){if(!t.clicked[e].right){let t=document.querySelectorAll(".result-box")[1];if(t)return t.querySelectorAll(".digit-result-box")[this.getPlaceIndex(e)]||null}}else{let t=document.querySelectorAll(".result-box")[0];if(t)return t.querySelectorAll(".digit-result-box")[this.getPlaceIndex(e)]||null}return null}getNextGuideDigitBox(){let e=this.progressState.currentPlace,t=this.getProgressState(),r=t.clicked[e].left,i=t.clicked[e].right;if(r){if(!i){let t=document.querySelectorAll(".result-box")[1];if(t){let r=t.querySelectorAll(".digit-result-box"),i=this.getPlaceIndex(e);if(r[i])return r[i]}}}else{let t=document.querySelectorAll(".result-box")[0];if(t){let r=t.querySelectorAll(".digit-result-box"),i=this.getPlaceIndex(e);if(r[i])return r[i]}}let s=this.getNextPlace(e);if(s){let e=document.querySelectorAll(".result-box")[0];if(e){let t=e.querySelectorAll(".digit-result-box"),r=this.getPlaceIndex(s);if(t[r])return t[r]}}return null}getPlaceIndex(e){switch(e){case"ones":return 2;case"tens":return 1;default:return 0}}getHandGuidePosition(e){var t;let r=e.getBoundingClientRect(),i=document.querySelector("#wrap"),s=i?i.getBoundingClientRect():{left:0,top:0},o=e.classList.contains("borrowable")||e.classList.contains("borrowable-highlight"),n=-10;o&&e.closest('.num-box[data-place="hundreds-result"]')&&(n=20);let a=o?r.left+n:r.right-80+10,l=o?r.top+32:r.bottom-100+30,u=(null==(t=window.bound)?void 0:t.scale)||1;return{x:(a-s.left)/u,y:(l-s.top)/u}}constructor(e={}){(0,i._)(this,"config",void 0),(0,i._)(this,"progressState",{currentPlace:"ones",clicked:{ones:{left:!1,right:!1},tens:{left:!1,right:!1},hundreds:{left:!1,right:!1},thousands:{left:!1,right:!1}}}),this.config=e}}class L{showResultScreen(){let e=document.querySelector(".result-screen");e&&(e.style.visibility="visible");let t=document.querySelector(".main-layout");t&&(t.style.visibility="hidden");let r=document.querySelector(".container");r&&(r.style.visibility="hidden")}setResultScreenValues(e,t,r){let i=y(e),s=i.hundreds,o=i.tens,n=i.ones,a=y(r),l=a.hundreds,u=a.tens,c=a.ones,h=document.querySelectorAll(".result-box")[0];if(h){let e=h.querySelector('.digit-result[data-place="hundreds-result"]'),t=h.querySelector('.digit-result[data-place="tens-result"]'),r=h.querySelector('.digit-result[data-place="ones-result"]');e&&(e.textContent=s.toString()),t&&(t.textContent=o.toString()),r&&(r.textContent=n.toString())}let d=document.querySelectorAll(".result-box")[1];if(d){let e=d.querySelector('.digit-result[data-place="hundreds-result"]'),t=d.querySelector('.digit-result[data-place="tens-result"]'),r=d.querySelector('.digit-result[data-place="ones-result"]');e&&(e.textContent=l.toString()),t&&(t.textContent=u.toString()),r&&(r.textContent=c.toString())}document.querySelectorAll(".operator-sign .sign").forEach(e=>{e.style.display=e.getAttribute("data-op")===t?"":"none"});let g=document.querySelector(".operator-display");g&&(g.textContent=t)}resetResultScreen(){if(this.renderer){var e;document.querySelectorAll(".num-box").forEach(e=>{var t;null==(t=this.renderer)||t.resetNumBox(e)}),null==(e=this.renderer)||e.removeAllCarryGroups()}else document.querySelectorAll(".num-box").forEach(e=>{e.innerHTML="",e.classList.remove("merged-only","has-both-groups","active");let t=e.querySelector(".num-model-count");t&&t.remove()}),document.querySelectorAll(".ten-carry-group, .hun-carry-group, .thou-carry-group").forEach(e=>{e.remove()});document.querySelectorAll(".result-image-container").forEach(e=>{e.innerHTML=""}),this.setResultBoxClickEnabled(!0)}setupResultBoxClick(e){document.querySelectorAll(".result-box").forEach((t,r)=>{let i=t.querySelectorAll(".digit-result-box");i.forEach((t,s)=>{let o=i.length-1-s;t.addEventListener("click",()=>{e(t,r,o)})})})}setResultBoxClickEnabled(e){document.querySelectorAll(".digit-result-box").forEach(t=>{t.style.pointerEvents=e?"auto":"none"})}setFixedButtonsVisibility(e){let t=document.querySelector(".result-btns-fixed"),r=document.querySelector(".right-btns-fixed");t&&(t.style.visibility=e?"visible":"hidden"),r&&(r.style.visibility=e?"visible":"hidden")}constructor(e={},t){(0,i._)(this,"config",void 0),(0,i._)(this,"renderer",void 0),this.config=e,this.renderer=t}}class R{async start(){if(this.deps.state.isAnimating||(this.deps.state.isCalculationComplete&&(await this.deps.resetResultScreenWithoutHandGuide(),this.deps.state.isCalculationComplete=!1,this.deps.state.currentStepIndex=0,await new Promise(e=>setTimeout(e,100))),this.deps.state.isAutoCalculating))return;this.deps.state.isCalculationComplete&&this.deps.state.isAutoCalculating&&(this.deps.state.isCalculationComplete=!1,this.deps.state.currentStepIndex=0),this.deps.handGuide.setAutoCalculating(!0),this.deps.userInputManager.pause();let e=Math.max(this.deps.state.currentStepIndex,0);this.deps.state.startAutoCalc(),this.deps.uiManager.setAutoCalcButtonState(!0);let t=this.deps.getMaxCalculationPlace(),r=p.indexOf(t);for(let t=e;t<=r;t++){if(!this.deps.state.isAutoCalculating||(await this.animatePlaceValue(t),!this.deps.state.isAutoCalculating))return;this.deps.state.currentStepIndex=t+1}this.deps.state.isAutoCalculating&&(this.deps.state.resetCalcFlags(),this.deps.handGuide.setAutoCalculating(!1),this.deps.userInputManager.disable(),this.deps.state.finishCalc(),this.deps.resultManager.setResultBoxClickEnabled(!1),this.deps.addGlobalClickBlocker(e=>{e.target.closest(".digit-result-box")&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}),this.deps.handGuide.stopAutoGuide(),this.deps.uiManager.setAutoCalcButtonState(!1),this.deps.showCalculationResultPopup())}async animatePlaceValue(e){if(!this.deps.state.isAutoCalculating)return;p[e];let t=this.deps.getMaxCalculationPlace();if(!(e>p.indexOf(t))){if(0===e){if(!this.deps.state.isAutoCalculating)return;let e=document.querySelectorAll(".result-box")[0].querySelectorAll(".digit-result-box"),t=e[e.length-1];if(t&&(await this.deps.handleResultBoxClickAsync(t,0,0),await new Promise(e=>setTimeout(e,1700))),!this.deps.state.isAutoCalculating)return;this.deps.isSubtractionOperator&&this.deps.isSubtractionOperator()&&(await this.maybeAutoBorrowForPlace("ones"),await new Promise(e=>setTimeout(e,1e3)));let r=document.querySelectorAll(".result-box")[1].querySelectorAll(".digit-result-box"),i=r[r.length-1];i&&(await this.deps.handleResultBoxClickAsync(i,1,0),await new Promise(e=>setTimeout(e,200)));return}if(1===e){{let e=Date.now();for(;Date.now()-e<800;){let e=document.querySelector(".num-box.active");if(e&&"tens-result"===e.getAttribute("data-place"))break;await new Promise(e=>setTimeout(e,30))}}if(this.deps.isSubtractionOperator&&this.deps.isSubtractionOperator()||await new Promise(e=>setTimeout(e,1200)),!this.deps.state.isAutoCalculating)return;let e=document.querySelectorAll(".result-box")[0].querySelectorAll(".digit-result-box"),t=e[e.length-1-1];if(t&&(await this.deps.handleResultBoxClickAsync(t,0,1),await new Promise(e=>setTimeout(e,1200))),!this.deps.state.isAutoCalculating)return;this.deps.isSubtractionOperator&&this.deps.isSubtractionOperator()&&(await this.maybeAutoBorrowForPlace("tens"),await new Promise(e=>setTimeout(e,250)));let r=document.querySelectorAll(".result-box")[1].querySelectorAll(".digit-result-box"),i=r[r.length-1-1];i&&(await this.deps.handleResultBoxClickAsync(i,1,1),await new Promise(e=>setTimeout(e,1200)));return}if(2===e){{let e=Date.now();for(;Date.now()-e<800;){let e=document.querySelector(".num-box.active");if(e&&"hundreds-result"===e.getAttribute("data-place"))break;await new Promise(e=>setTimeout(e,30))}}if(this.deps.isSubtractionOperator&&this.deps.isSubtractionOperator()||await new Promise(e=>setTimeout(e,500)),!this.deps.state.isAutoCalculating)return;let e=document.querySelectorAll(".result-box")[0].querySelectorAll(".digit-result-box"),t=e[e.length-1-2];if(t&&(await this.deps.handleResultBoxClickAsync(t,0,2),await new Promise(e=>setTimeout(e,1700))),!this.deps.state.isAutoCalculating)return;this.deps.isSubtractionOperator&&this.deps.isSubtractionOperator()&&(await this.maybeAutoBorrowForPlace("hundreds"),await new Promise(e=>setTimeout(e,600)));let r=document.querySelectorAll(".result-box")[1].querySelectorAll(".digit-result-box"),i=r[r.length-1-2];i&&(await this.deps.handleResultBoxClickAsync(i,1,2),await new Promise(e=>setTimeout(e,1700)));return}for(let t=0;t<2;t++){if(!this.deps.state.isAutoCalculating)return;window.__numModelUIProgressState;let r=document.querySelectorAll(".result-box")[t].querySelectorAll(".digit-result-box"),i=r[r.length-1-e];i&&await this.deps.handleResultBoxClickAsync(i,t,e)}}}async maybeAutoBorrowForPlace(e){try{let t="ones"===e?3:1;for(let r=0;r<t;r++){if(!this.deps.state.isAutoCalculating||!this.deps.checkBorrowNeeded(e))return;let t=this.deps.findNearestBorrowablePlace(e);if(!t)return;await this.deps.autoPerformBorrow(t),await new Promise(e=>setTimeout(e,800))}}catch{}}constructor(e){(0,i._)(this,"deps",void 0),this.deps=e}}class D{placeLeftGroup(e){let t=document.querySelector(`.num-box[data-place="${e}-result"]`);if(!t)return;let r=this.deps.inputManager.getNumberFromDisplays("left"),i=this.deps.calculationManager.splitNumberByPlaces(r),s="ones"===e?i.ones:"tens"===e?i.tens:"hundreds"===e?i.hundreds:0;"ones"!==e&&(s=function(e,t,r){let i=0;i="ones"===e?t.ones:"tens"===e?t.tens:t.hundreds;let s=["ones","tens","hundreds"],o=s.indexOf(e);if(o>0){let e=s[o-1];r.has(e)&&(i=Math.max(0,i-1))}return i}(e,{ones:i.ones,tens:i.tens,hundreds:i.hundreds},this.deps.borrowedPlaces)),this.deps.renderer.placeLeftGroupForSubtraction(t,e,s),this.deps.renderer.updateSubtractionCount(t,e,s,()=>!1)}async applyVisual(e){let t=document.querySelector(`.num-box[data-place="${e}-result"]`);if(!t)return;let r=this.getDigit(this.deps.inputManager.getNumberFromDisplays("right"),e);await this.deps.effects.runSubtractionHighlightAndFade(t,e,r,this.deps.state.isAutoCalculating)}mergeGroups(e,t){let r=document.querySelector(`.num-box[data-place="${e}-result"]`);if(r){r.querySelectorAll(".num-model-group.group-left, .num-model-group.group-right").forEach(e=>e.remove()),r.classList.remove("has-both-groups"),r.classList.add("merged-only");let t=this.deps.inputManager.getNumberFromDisplays("left"),i=this.deps.inputManager.getNumberFromDisplays("right"),s=this.deps.buildBorrowedCounts(),o=this.deps.logic.computeSubtractionDigitForPlace(t,i,e,s,this.deps.borrowedPlaces);this.deps.renderer.appendMerged(r,e,o),this.deps.renderer.updateSubtractionCount(r,e,o,()=>!1)}t&&t()}updateAllPlaces(){let e=this.deps.inputManager.getNumberFromDisplays("left")-this.deps.inputManager.getNumberFromDisplays("right"),t=this.getMaxCalculationPlace(),r=["ones","tens","hundreds"],i=r.indexOf(t);for(let t=0;t<=i;t++){let i=r[t],s=this.getDigit(e,i),o=document.querySelector(`.num-box[data-place="${i}-result"]`);o&&(this.updateCount(o,i,s),function(e,t,r){var i;let s=e.querySelector(".num-model-count");s&&(null==(i=s.textContent)?void 0:i.trim())==="0"&&C(r,t)&&s.remove()}(o,i,e))}}isCalculationComplete(){return!!this.deps.state.isCalculationComplete}updateCount(e,t,r){let i=this.deps.inputManager.getNumberFromDisplays("left")-this.deps.inputManager.getNumberFromDisplays("right");this.deps.renderer.updateSubtractionCount(e,t,r,e=>C(i,e))}getDigit(e,t){return"ones"===t?e%10:"tens"===t?Math.floor(e%100/10):"hundreds"===t?Math.floor(e%1e3/100):0}getMaxCalculationPlace(){return"hundreds"}constructor(e){(0,i._)(this,"deps",void 0),this.deps=e}}class O{showBorrowUI(e){if("ones"===e)return;let t=["ones","tens","hundreds"],r=t.indexOf(e);if(r>0){let e=t[r-1];if(this.deps.accessors.isBorrowedPlace(e))return void this.deps.state.endBorrowProcess()}this.deps.state.startBorrowProcess(e),this.deps.borrowUI.showBorrowUI(e)}async handleBorrowClick(e,t){let r=["ones","tens","hundreds"],i=r.indexOf(e);if(i>0){let e=r[i-1];if(this.deps.accessors.isBorrowedPlace(e))return null}t.classList.remove("borrowable");let{updatedBorrowedCounts:s,to:o}=this.deps.logic.applyBorrow(this.deps.accessors.getBorrowedCountsRecord(),e);if(!o)return null;Object.keys(s).forEach(e=>{this.deps.accessors.setBorrowCount(e,s[e]??0)}),t.remove();let n=this.deps.helpers.numBoxFor(o);if(!n)return null;let a=this.deps.helpers.ensureGroup(n,"left",o),l="ones"===o?"one.png":"ten.png",u="ones"===o?"Number 1":"Number 10",c=a.querySelectorAll(".num-model-img"),h=c.length,d=h+10;if(d>10?this.deps.helpers.splitGroupsAndDistribute(n,c,o,l,h,10,u):this.deps.helpers.appendImagesToGroup(a,l,10,h,u),this.deps.state.endBorrowProcess(),"hundreds"===e&&"tens"===o&&this.deps.logic.needsBorrow){let e=this.deps.accessors.getLeftNumber(),t=this.deps.accessors.getRightNumber?this.deps.accessors.getRightNumber():0,r=this.deps.accessors.getBorrowedCountsRecord();this.deps.logic.needsBorrow(e,t,"ones",r)&&setTimeout(()=>this.deps.borrowUI.showBorrowUI("tens"),200)}return{to:o,totalImages:d,wasBorrowedPlace:this.deps.accessors.isBorrowedPlace(e)}}constructor(e){(0,i._)(this,"deps",void 0),this.deps=e}}class $ extends g{get isAnimating(){return this.state.isAnimating}set isAnimating(e){this.state.isAnimating=e}get currentStepIndex(){return this.state.currentStepIndex}set currentStepIndex(e){this.state.currentStepIndex=e}get isAutoCalculating(){return this.state.isAutoCalculating}set isAutoCalculating(e){this.state.isAutoCalculating=e}get isCalculationComplete(){return this.state.isCalculationComplete}set isCalculationComplete(e){this.state.isCalculationComplete=e}get isWaitingForBorrow(){return this.state.isWaitingForBorrow}set isWaitingForBorrow(e){this.state.isWaitingForBorrow=e}get borrowFromPlace(){return this.state.borrowFromPlace}set borrowFromPlace(e){this.state.borrowFromPlace=e}get borrowedPlaces(){return this.state.borrowedPlaces}get borrowCounts(){return this.state.borrowCounts}get currentBorrowTarget(){return this.state.currentBorrowTarget}set currentBorrowTarget(e){this.state.currentBorrowTarget=e}get isInBorrowProcess(){return this.state.isInBorrowProcess}set isInBorrowProcess(e){this.state.isInBorrowProcess=e}buildBorrowedCounts(){return this.state.getBorrowedCountsRecord()}syncBorrowCountsFromRecord(e){this.state.setBorrowedCountsFromRecord(e)}numBoxFor(e){return this.renderer.numBoxFor(e)}ensureGroup(e,t,r){return this.renderer.ensureGroup(e,t,r)}appendImagesToGroup(e,t,r,i,s){this.renderer.appendImagesToGroup(e,t,r,i,s)}splitGroupsAndDistribute(e,t,r,i,s,o,n){this.renderer.splitGroupsAndDistribute(e,t,r,i,s,o,n)}init(){super.init(),this.inputManager.init(),this.setupResultBoxClick(),this.highlightCurrentNumBox(),this.updateExpectedTargetMarker()}hnMessage(e){super.hnMessage(e),"CONTENT_RESIZE"===e.detail.message&&this.handleResize()}handleResize(){let e=document.querySelector("#wrap");e&&function(e){let{root:t,stageSize:r,cb:i}=e,s=Math.min(window.innerWidth/r.width,window.innerHeight/r.height),o=r.width*s,n=r.height*s,a=(window.innerWidth-o)/2,l=(window.innerHeight-n)/2;t.style.transformOrigin="top left",t.style.left=`${a}px`,t.style.top=`${l}px`,t.style.transform=`scale(${s})`;i&&i({zoom:s,x:a,y:l,scale:s})}({root:e,stageSize:{width:1280,height:720},cb:e=>{window.zoom=e.zoom,window.resizeData=e}}),a(window,{type:"CONTENT_RESIZE",module:this})}showModal(e){this.uiManager.showModal(e)}hideModal(){this.uiManager.hideModal()}showResultScreen(e,t,r){this.isAutoCalculating||(this.currentStepIndex=0,this.state.resetCalcFlags()),document.querySelectorAll(".container .image-container").forEach(e=>{e.innerHTML=""}),this.resultManager.showResultScreen(),this.resultManager.setFixedButtonsVisibility(!0),this.resultManager.setResultScreenValues(e,t,r),"-"===t&&(this.setInitialPlaceForSubtractionStart(e,r),this.highlightCurrentNumBox()),this.handGuide.setAutoCalculating(!1),this.initializeHandGuide();let i=this.calculationManager.splitNumberByPlaces(e),s=this.calculationManager.splitNumberByPlaces(r);this.inputManager.placeImages("hundreds-left",i.hundreds,!0),this.inputManager.placeImages("tens-left",i.tens,!0),this.inputManager.placeImages("ones-left",i.ones,!0),this.inputManager.placeImages("hundreds-right",s.hundreds,!0),this.inputManager.placeImages("tens-right",s.tens,!0),this.inputManager.placeImages("ones-right",s.ones,!0),"-"===t&&(this.inputManager.placeImages("hundreds-result",i.hundreds,!0),this.inputManager.placeImages("tens-result",i.tens,!0),this.inputManager.placeImages("ones-result",i.ones,!0))}calculate(){let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right"),r=this.inputManager.getSelectedOperator(),i=this.calculationManager.calculate(e,t,r);if(!i.isValid)return void this.showModal(i.errorMessage||"계산할 수 없습니다");this.isAutoCalculating||this.showResultScreen(e,r,t)}reset(){if(this.inputManager.resetInputScreen(),this.uiManager.resetProgressState(),this.tensCarryCount=0,this.hundredsCarryCount=0,"-"===this.inputManager.getSelectedOperator()){let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right");this.setInitialPlaceForSubtractionStart(e,t)}this.highlightCurrentNumBox(),this.currentStepIndex=0,this.state.resetCalcFlags(),this.state.resetBorrowState(),this.resultManager.resetResultScreen(),this.preventClickHandler&&(document.removeEventListener("click",this.preventClickHandler,!0),this.preventClickHandler=null),this.uiManager.setAutoCalcButtonState(!1),this.animationTimeouts.forEach(e=>clearTimeout(e)),this.animationTimeouts=[],this.handGuide.hide(),this.userInputManager.stop();let e=document.querySelector(".result-screen");e&&"visible"===getComputedStyle(e).visibility&&this.initializeHandGuide()}resetResultScreen(){this.state.resetCalcFlags(),this.animationTimeouts.forEach(e=>{clearTimeout(e)}),this.animationTimeouts=[],this.animationManager.stopAllAnimations(),this.resultManager.resetResultScreen();let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right"),r=this.calculationManager.splitNumberByPlaces(e),i=this.calculationManager.splitNumberByPlaces(t);if(this.inputManager.placeImages("hundreds-left",r.hundreds,!0),this.inputManager.placeImages("tens-left",r.tens,!0),this.inputManager.placeImages("ones-left",r.ones,!0),this.inputManager.placeImages("hundreds-right",i.hundreds,!0),this.inputManager.placeImages("tens-right",i.tens,!0),this.inputManager.placeImages("ones-right",i.ones,!0),this.uiManager.resetProgressState(),"-"===this.inputManager.getSelectedOperator()){let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right");this.setInitialPlaceForSubtractionStart(e,t)}this.tensCarryCount=0,this.hundredsCarryCount=0,this.currentStepIndex=0,this.state.resetBorrowState(),this.highlightCurrentNumBox(),this.uiManager.setButtonState(".btn-result-reset",!1),this.preventClickHandler&&(document.removeEventListener("click",this.preventClickHandler,!0),this.preventClickHandler=null),this.resultManager.setResultBoxClickEnabled(!0),this.uiManager.setAutoCalcButtonState(!1),this.handGuide.setAutoCalculating(!1),this.userInputManager.stop(),this.initializeHandGuide();let s=document.querySelector(".result-screen");s&&(this.userInputManager.start(s),this.userInputManager.reset()),this.resultManager.setResultBoxClickEnabled(!0)}resetResultScreenWithoutHandGuide(){if(this.state.resetCalcFlags(),this.animationTimeouts.forEach(e=>{clearTimeout(e)}),this.animationTimeouts=[],this.animationManager.stopAllAnimations(),document.querySelectorAll(".num-box").forEach(e=>{this.renderer.resetNumBox(e)}),this.renderer.removeAllCarryGroups(),this.uiManager.resetProgressState(),"-"===this.inputManager.getSelectedOperator()){let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right");this.setInitialPlaceForSubtractionStart(e,t)}this.tensCarryCount=0,this.hundredsCarryCount=0,this.currentStepIndex=0,this.state.resetBorrowState(),this.isCalculationComplete=!1,this.highlightCurrentNumBox(),this.uiManager.setButtonState(".btn-result-reset",!1),this.preventClickHandler&&(document.removeEventListener("click",this.preventClickHandler,!0),this.preventClickHandler=null),this.resultManager.setResultBoxClickEnabled(!0),this.uiManager.setAutoCalcButtonState(!1),this.handGuide.setAutoCalculating(!1)}resetInputScreen(){this.inputManager.resetInputScreen(),this.currentStepIndex=0,this.state.resetCalcFlags(),this.resultManager.setFixedButtonsVisibility(!1)}goToHome(){this.state.resetCalcFlags(),this.state.stopAnimating(),this.isCalculationComplete=!1,this.animationTimeouts.forEach(e=>{clearTimeout(e)}),this.animationTimeouts=[],this.animationManager.stopAllAnimations(),this.renderer.removeAllCarryGroups(),this.uiManager.showInputScreen(),this.resetInputScreen(),this.resetResultScreenWithoutHandGuide(),this.handGuide.setAutoCalculating(!0),this.handGuide.forceStop(),this.handGuide.stopAutoGuide(),this.handGuide.hide(),this.userInputManager.stop(),this.preventClickHandler&&(document.removeEventListener("click",this.preventClickHandler,!0),this.preventClickHandler=null),this.resultManager.setResultBoxClickEnabled(!0)}setupResultBoxClick(){this.resultManager.setupResultBoxClick((e,t,r)=>{this.handleResultBoxClick(e,t,r)})}handleResultBoxClick(e,t,r){if(this.isAnimating||this.isCalculationComplete||this.isAutoCalculating)return;let i=p[r],s=0===t?"left":"right",o=this.getNextGuideTargetElement();"-"===this.inputManager.getSelectedOperator()&&o&&(o===e||o.contains(e)||e.contains(o)||this.userInputManager.reportWrongClick());let n=this.inputManager.getSelectedOperator(),a=this.uiManager.getProgressState();if("-"===n&&"right"===s&&!a.clicked[i].left&&i===this.uiManager.getCurrentPlace()){let e=this.uiManager.getProgressState(),t="tens"===i&&e.clicked.ones.left&&e.clicked.ones.right,r="tens"===i&&this.borrowedPlaces.has("ones"),s=t&&r&&!this.checkBorrowNeeded("tens"),o="hundreds"===i&&e.clicked.ones.left&&e.clicked.ones.right&&e.clicked.tens.left&&e.clicked.tens.right,n="hundreds"===i&&this.borrowedPlaces.has("tens"),a=o&&n&&!this.checkBorrowNeeded("hundreds");if(!s&&!a)return void this.showModal("빼어지는 수를 먼저 눌러주세요.");{let e=document.querySelector(`.num-box[data-place="${i}-result"]`);(null==e?void 0:e.querySelector(".num-model-group.group-left"))||(null==e?void 0:e.querySelector(".num-model-count"))||this.placeNumModelInCalcContainerForSubtraction(i,"left"),this.uiManager.setClickedState(i,"left",!0)}}if(this.isInBorrowProcess){let e=i===this.borrowFromPlace;if("hundreds"===this.borrowFromPlace&&"tens"===i&&"left"===s){let e=document.querySelector('.num-box[data-place="tens-result"]');(null==e?void 0:e.querySelector(".num-model-group.group-left"))||this.placeNumModelInCalcContainerForSubtraction("tens","left");return}if(!e){"right"===s&&i===this.uiManager.getCurrentPlace()&&(this.borrowFromPlace&&this.showBorrowUI(this.borrowFromPlace),this.showModal("먼저 앞자리 수를 빌려오세요."));return}if("left"===s){let e=document.querySelector(`.num-box[data-place="${i}-result"]`);(null==e?void 0:e.querySelector(".num-model-group.group-left"))||this.placeNumModelInCalcContainerForSubtraction(i,s),this.borrowFromPlace&&this.showBorrowUI(this.borrowFromPlace),this.clearResultImageContainer(i,s)}return}if(i!==this.uiManager.getCurrentPlace()){if("-"===n&&"left"===s&&"ones"===this.uiManager.getCurrentPlace()&&!this.uiManager.getProgressState().clicked.ones.left)return void this.userInputManager.reportWrongClick();if(this.isWaitingForBorrow&&i===this.borrowFromPlace);else{if("-"!==n||"left"!==s)return void this.userInputManager.reportWrongClick();let e=this.uiManager.getCurrentPlace(),t=p.indexOf(e),r=p.indexOf(i),o=this.getMaxCalculationPlace(),a=p.indexOf(o);if(r>t){if(this.uiManager.getProgressState().clicked[e].left,!this.checkBorrowNeeded(e)||!(r<=a))return void this.userInputManager.reportWrongClick();{let s=this.findNearestBorrowablePlace(e);if(!s||i!==s)return void this.userInputManager.reportWrongClick();r>t+1&&this.createMissingPlaceImages(e,i)}}else if(!(r<=a))return void this.userInputManager.reportWrongClick()}}let l=this.uiManager.getProgressState();if(l.clicked[i][s]){"-"===this.inputManager.getSelectedOperator()&&"left"===s&&i===this.uiManager.getCurrentPlace()&&this.clearResultImageContainer(i,s);return}let u=this.inputManager.getSelectedOperator(),c=!("-"===u&&"right"===s&&!l.clicked[i].left),h=!0;if("-"===u&&"right"===s&&this.checkBorrowNeeded(i)&&(h=!1),c&&h&&(this.handleCorrectClick(),this.uiManager.setClickedState(i,s,!0),this.uiManager.setButtonState(".btn-result-reset",!0),this.clearResultImageContainer(i,s)),"-"===n){if("left"===s){if(this.isTwoStepBorrowScenario&&this.isTwoStepBorrowScenario()){let e=this.uiManager.getProgressState();if("tens"===i&&!e.clicked.ones.left||"hundreds"===i&&(!e.clicked.ones.left||!e.clicked.tens.left))return void this.showModal("먼저 앞자리 수를 빌려오세요.")}let e=this.inputManager.getNumberFromDisplays("left"),t=this.calculationManager.splitNumberByPlaces(e);"ones"===i?t.ones:"tens"===i?t.tens:"hundreds"===i&&t.hundreds,this.placeNumModelInCalcContainerForSubtraction(i,s);let r=this.getDigitAtPlace(e,i);if(r>0){let e=["ones","tens","hundreds"],t=e.indexOf(i);for(let r=0;r<t;r++){let t=e[r];if(this.checkBorrowNeeded(t)){this.showBorrowUI(i);break}}}else if(0===r){let e=["ones","tens","hundreds"],t=e.indexOf(i);for(let r=0;r<t;r++){let t=e[r];if(this.checkBorrowNeeded(t))break}if(this.checkBorrowNeeded(i))if("ones"===i){let e=this.findBorrowablePlace(i);e&&(this.state.startBorrowProcess(e),this.showBorrowUI(e));return}else{let e=this.findNearestBorrowablePlace(i);e&&(this.uiManager.setCurrentPlace(e),this.highlightCurrentNumBox())}}if(!this.isInBorrowProcess&&this.checkBorrowNeeded(i)){let e=this.findBorrowablePlace(i);e&&(this.state.startBorrowProcess(e),this.showBorrowUI(e))}}else if("right"===s){if(!l.clicked[i].left){let e=document.querySelector(`.num-box[data-place="${i}-result"]`),t=!!(null==e?void 0:e.querySelector(".num-model-group.group-left"))||!!(null==e?void 0:e.querySelector(".num-model-count"));if("-"!==n||!t&&this.checkBorrowNeeded(i))return void this.showModal("빼어지는 수를 먼저 클릭하세요.");t||this.placeNumModelInCalcContainerForSubtraction(i,"left"),this.uiManager.setClickedState(i,"left",!0)}if("-"===n&&this.isTwoStepBorrowScenario&&this.isTwoStepBorrowScenario()){let e=this.uiManager.getProgressState();if(e.clicked.ones.left&&e.clicked.tens.left&&!e.clicked.hundreds.left&&"hundreds"===i)return void this.showModal("먼저 앞자리 수를 빌려오세요.")}if(this.isInBorrowProcess)if(!this.checkBorrowNeeded(i)||this.borrowedPlaces.has("ones")||this.borrowedPlaces.has("tens"))this.state.endBorrowProcess();else{this.borrowFromPlace&&this.showBorrowUI(this.borrowFromPlace),this.uiManager.setClickedState(i,s,!1);return}if(this.checkBorrowNeeded(i)&&!this.borrowedPlaces.has(i)){let e=this.findBorrowablePlace(i);if(!e)return void this.showModal("빌림할 수 있는 자리가 없습니다.");{this.isInBorrowProcess||(this.showModal("먼저 앞자리 수를 빌려오세요."),this.state.startBorrowProcess(e));let t=this.getBorrowToPlace(e);if(t){let e=document.querySelector(`.num-box[data-place="${t}-result"]`);(null==e?void 0:e.querySelector(".num-model-group.group-left"))||this.placeNumModelInCalcContainerForSubtraction(t,"left")}this.uiManager.setClickedState(i,s,!1);return}}this.uiManager.getProgressState().clicked[i].left||(this.placeNumModelInCalcContainerForSubtraction(i,"left"),this.uiManager.setClickedState(i,"left",!0)),this.applySubtractionVisualEffect(i,s);let e=setTimeout(()=>{if(!this.isAutoCalculating&&!this.isAnimating){this.animationTimeouts=this.animationTimeouts.filter(t=>t!==e);return}this.mergeNumModelGroupsForSubtraction(i,()=>{}),this.animationTimeouts=this.animationTimeouts.filter(t=>t!==e)},2300);this.animationTimeouts.push(e)}}else this.placeNumModelInCalcContainer(i,s);if(this.uiManager.setButtonState(".btn-result-reset",!0),l.clicked[i].left&&l.clicked[i].right){let e=this.getMaxCalculationPlace(),t=p.indexOf(e),r=p.indexOf(i),s=this.getNextPlace(i);if(s&&r<t){this.state.startAnimating(),this.state.startAnimating();let e=setTimeout(()=>{if(!this.isAutoCalculating&&!this.isAnimating)return;let t=document.querySelector(`.num-box[data-place="${i}-result"]`);t&&("-"===this.inputManager.getSelectedOperator()?this.mergeNumModelGroupsForSubtraction(i,()=>{if(s){let e=this.getDigitAtPlace(this.inputManager.getNumberFromDisplays("left"),s);this.getDigitAtPlace(this.inputManager.getNumberFromDisplays("right"),s),"ones"===i&&this.borrowedPlaces.has("ones")&&(e=Math.max(0,e-1)),this.checkRemainingCalculation(s)?(this.uiManager.setCurrentPlace(s),this.highlightCurrentNumBox(),this.state.stopAnimating(),this.userInputManager.restartAutoGuideTimer()):(this.clearAllHighlights(),this.uiManager.deactivateAllDigitResultBoxesHighlight(),this.handGuide.hide(),this.handGuide.stopAutoGuide(),this.userInputManager.disable(),this.state.finishCalc(),this.state.stopAnimating(),this.resultManager.setResultBoxClickEnabled(!1),this.preventClickHandler=e=>{e.target.closest(".digit-result-box")&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())},this.preventClickHandler&&document.addEventListener("click",this.preventClickHandler,!0),this.userInputManager.reset(),"-"===this.inputManager.getSelectedOperator()&&this.updateAllPlacesForSubtraction(),this.showCalculationResultPopup())}}):this.mergeNumModelGroups(t,i,()=>{"thousands"===s?(this.clearAllHighlights(),this.uiManager.deactivateAllDigitResultBoxesHighlight(),this.handGuide.hide(),this.handGuide.stopAutoGuide(),this.userInputManager.disable(),this.state.finishCalc(),this.state.stopAnimating(),this.resultManager.setResultBoxClickEnabled(!1),this.preventClickHandler=e=>{e.target.closest(".digit-result-box")&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())},this.preventClickHandler&&document.addEventListener("click",this.preventClickHandler,!0),this.userInputManager.reset(),this.updateAllPlacesForAddition(),this.showCalculationResultPopup()):(this.uiManager.setCurrentPlace(s),this.highlightCurrentNumBox(),this.state.stopAnimating(),this.userInputManager.restartAutoGuideTimer())})),this.animationTimeouts=this.animationTimeouts.filter(t=>t!==e)},1200);this.animationTimeouts.push(e)}else{this.state.startAnimating();let e=setTimeout(()=>{if(!this.isAutoCalculating&&!this.isAnimating)return;let t=document.querySelector(`.num-box[data-place="${i}-result"]`);t&&("-"===this.inputManager.getSelectedOperator()?this.mergeNumModelGroupsForSubtraction(i,()=>{this.clearAllHighlights(),this.uiManager.deactivateAllDigitResultBoxesHighlight(),this.handGuide.hide(),this.handGuide.stopAutoGuide(),this.userInputManager.disable(),this.state.finishCalc(),this.state.stopAnimating(),this.resultManager.setResultBoxClickEnabled(!1),this.preventClickHandler=e=>{e.target.closest(".digit-result-box")&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())},this.preventClickHandler&&document.addEventListener("click",this.preventClickHandler,!0),this.userInputManager.reset(),"-"===this.inputManager.getSelectedOperator()&&this.updateAllPlacesForSubtraction(),this.showCalculationResultPopup()}):this.mergeNumModelGroups(t,i,()=>{this.clearAllHighlights(),this.uiManager.deactivateAllDigitResultBoxesHighlight(),this.handGuide.hide(),this.handGuide.stopAutoGuide(),this.userInputManager.disable(),this.state.finishCalc(),this.state.stopAnimating(),this.resultManager.setResultBoxClickEnabled(!1),this.preventClickHandler=e=>{e.target.closest(".digit-result-box")&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())},this.preventClickHandler&&document.addEventListener("click",this.preventClickHandler,!0),this.userInputManager.reset(),this.updateAllPlacesForSubtraction(),this.showCalculationResultPopup()})),this.animationTimeouts=this.animationTimeouts.filter(t=>t!==e)},"ones"===i?2e3:3500);this.animationTimeouts.push(e)}}}highlightCurrentNumBox(){this.uiManager.highlightCurrentNumBox();let e=this.inputManager.getSelectedOperator(),t=this.uiManager.getCurrentPlace(),r=this.uiManager.getProgressState();if(!("-"===e&&r.clicked[t].left&&r.clicked[t].right)){var i;let t="-"===e?this.getNextGuideTargetElement():this.getNextGuideDigitBox(),r=(null==t||null==(i=t.closest)?void 0:i.call(t,".digit-result-box"))||null;this.uiManager.setActiveDigitResultBox(r)}}getNextPlace(e){return this.uiManager.getNextPlace(e)}placeNumModelInCalcContainer(e,t){let r=document.querySelector(`.num-box[data-place="${e}-result"]`);if(!r)return;this.renderer.removeMergedOnly(r);let i=this.inputManager.getSelectedOperator(),s=this.uiManager.getCurrentPlace();if(("+"!==i||e===s)&&this.updateNumModelCountForCurrentState(r,e),"hundreds"===e){let i=r.querySelector(".group-merged"),s=i?i.querySelectorAll("img"):null,o=!!i&&!!s&&s.length>0,n=r.querySelector(".num-model-group.group-left"),a=!!n&&n.querySelectorAll("img.hun-carry").length>0,l=o||a,u=this.ensureGroup(r,t,e);if("left"===t&&l||(u.innerHTML=""),o&&((n=r.querySelector(".num-model-group.group-left"))||(n=this.ensureGroup(r,"left",e)),n.innerHTML="",s.forEach(e=>n.appendChild(e)),i.remove()),!l&&this.hundredsCarryCount>0&&"right"===t){(n=r.querySelector(".num-model-group.group-left"))||(n=this.ensureGroup(r,"left",e));let t=document.createDocumentFragment();for(let e=0;e<this.hundredsCarryCount;e++){let e=document.createElement("img");e.src="./images/hun.png",e.className="num-model-img hun-carry",t.appendChild(e)}n.appendChild(t)}let c=+("left"!==t),h=document.querySelectorAll('.digit-result[data-place="hundreds-result"]')[c],d=h?parseInt(h.textContent||"0",10):0;if("left"!==t||l||(d+=this.hundredsCarryCount),0===d){u&&u.remove(),this.renderer.toggleHasBothGroups(r),this.updateNumModelCountForCurrentState(r,e);return}this.renderer.appendImagesToGroup(u,"hun.png",d,0,"Number 100");let g=r.querySelector(".num-model-group.group-left");g&&this.renderer.stackGroupImagesCentered(g);let p=r.querySelector(".num-model-group.group-right");p&&this.renderer.stackGroupImagesCentered(p),this.renderer.toggleHasBothGroups(r);return}if("tens"===e&&r.querySelector(".group-merged")){let i=+("left"!==t),s=`.digit-result[data-place="${e}-result"]`,o=document.querySelectorAll(s)[i],n=o?parseInt(o.textContent||"0",10):0;if(0===n){this.renderer.toggleHasBothGroups(r),this.updateNumModelCountForCurrentState(r,e);return}this.renderer.ensureSideGroupWithValue(r,t,e,n),this.renderer.toggleHasBothGroups(r);return}let o=this.ensureGroup(r,t,e);o.innerHTML="";let n=+("left"!==t),a=`.digit-result[data-place="${e}-result"]`,l=document.querySelectorAll(a)[n],u=l?parseInt(l.textContent||"0",10):0,c=u;if("tens"===e&&"left"===t&&(c+=this.tensCarryCount),0===c){o&&o.remove(),this.renderer.toggleHasBothGroups(r),this.updateNumModelCountForCurrentState(r,e);return}let h="./images/one.png";"tens"===e&&(h="./images/ten.png"),"thousands"===e&&(h="./images/thousand.png"),"tens"===e&&"left"===t&&(u=c),this.renderer.appendImagesToGroup(o,h.split("/").pop(),u,0,"Number"),this.renderer.toggleHasBothGroups(r),"ones"===e&&this.updateOnesCenteredLayout(r,e);let d=this.uiManager.getProgressState();if(d.clicked[e].left&&d.clicked[e].right&&"ones"!==e&&!this.isAutoCalculating){let t=setTimeout(()=>{this.mergeNumModelGroups(r,e),this.animationTimeouts=this.animationTimeouts.filter(e=>e!==t)},2e3);this.animationTimeouts.push(t)}}updateOnesCenteredLayout(e,t){try{var r,i;let s=this.uiManager.getProgressState(),o=document.querySelectorAll('.digit-result[data-place="ones-result"]'),n=parseInt((null==(r=o[0])?void 0:r.textContent)||"0",10)||0,a=parseInt((null==(i=o[1])?void 0:i.textContent)||"0",10)||0,l=s.clicked.ones.left?n:0,u=s.clicked.ones.right?a:0,c=l+u,h=this.renderer.getGroup(e,"left"),d=this.renderer.getGroup(e,"right");if(c<=10){let t=this.renderer.clearAndEnsureMergedGroup(e);for(let e=0;e<c;e++){let e=document.createElement("img");e.src="./images/one.png",e.className="num-model-img",t.appendChild(e)}h&&(h.style.display="none"),d&&(d.style.display="none"),e.classList.remove("has-both-groups");return}let g=this.renderer.getGroup(e,"merged");this.renderer.removeGroup(g);let p=this.ensureGroup(e,"left",t);p.innerHTML="";for(let e=0;e<10;e++){let e=document.createElement("img");e.src="./images/one.png",e.className="num-model-img",p.appendChild(e)}p.style.display="";let m=c-10,f=this.ensureGroup(e,"right",t);f.innerHTML="";for(let e=0;e<m;e++){let e=document.createElement("img");e.src="./images/one.png",e.className="num-model-img",f.appendChild(e)}f.style.display="",this.renderer.toggleHasBothGroups(e)}catch(e){}}mergeNumModelGroups(e,t,r){let i=this.renderer.getGroup(e,"left"),s=this.renderer.getGroup(e,"right"),o=this.renderer.countImagesIn(i)+this.renderer.countImagesIn(s);"tens"===t&&(o+=this.renderer.countCarryInMerged(e,"ten.png")),"hundreds"===t&&(o+=this.renderer.countCarryInMerged(e,"hun.png")),this.renderer.removeGroup(i),this.renderer.removeGroup(s),this.renderer.setMergedOnly(e,!0);let n=o,a=0;"ones"===t&&o>=10&&(n=o%10,a=Math.floor(o/10));let l=o,u=0;"tens"===t&&o>=10&&(l=o%10,u=Math.floor(o/10));let c=o,h=0;"hundreds"===t&&o>=10&&(c=o%10,h=Math.floor(o/10));let d=this.renderer.clearAndEnsureMergedGroup(e);if("ones"===t||"hundreds"===t&&h>0?this.renderer.updateNumModelCount(e,o):this.updateNumModelCountWithTotal(e,t),"ones"===t&&a>0){this.renderer.updateNumModelCount(e,o),n>0?this.renderer.appendMerged(e,"ones",n):d.remove();let i=this.renderer.createCarryGroupLeft(e,"ten","ten.png",a);this.tensCarryCount+=a;let s=setTimeout(()=>{if(this.isAutoCalculating&&!this.isAnimating)return;let o=i.querySelectorAll("img.ten-carry"),a=document.querySelector('.num-box[data-place="tens-result"]');a?this.renderer.prepareMergedAndAppend(a,o):o.forEach(e=>e.remove()),i&&i.remove(),this.renderer.removeMergedOnly(e),this.renderer.removeEmptyGroups(e),this.updateNumModelCountForRemaining(e,t,n),a&&this.updateNumModelCountForCurrentState(a,"tens"),r&&r(),this.animationTimeouts=this.animationTimeouts.filter(e=>e!==s)},1500);this.animationTimeouts.push(s);return}if("tens"===t&&u>0){this.state.startAnimating(),this.renderer.updateNumModelCount(e,o),l>0&&this.renderer.appendMerged(e,"tens",l);let i=this.renderer.createCarryGroupLeft(e,"hun","hun.png",u);this.animationManager.fadeIn(i,.3);let s=setTimeout(()=>{let o=i.querySelectorAll("img.hun-carry"),n=document.querySelector('.num-box[data-place="hundreds-result"]');n&&o.length>0?(this.renderer.prepareMergedAndAppend(n,o),this.animationManager.animateModelMovement("tens-result","hundreds-result",()=>{}),setTimeout(()=>{this.updateNumModelCountForCurrentState(n,"hundreds")},100)):o.forEach(e=>e.remove()),i&&i.remove(),this.renderer.removeMergedOnly(e),this.hundredsCarryCount+=u,this.updateNumModelCountForRemaining(e,t,l),setTimeout(()=>{n&&this.updateNumModelCountForCurrentState(n,"hundreds")},100),this.state.stopAnimating(),r&&r(),this.animationTimeouts=this.animationTimeouts.filter(e=>e!==s)},1500);this.animationTimeouts.push(s);return}if("hundreds"===t&&h>0){if(this.renderer.updateNumModelCount(e,o),c>0){this.renderer.appendMerged(e,"hundreds",c);let t=this.renderer.getGroup(e,"merged");t&&this.renderer.stackGroupImagesCentered(t),this.renderer.removeMergedOnly(e)}else d.remove();let i=this.renderer.createCarryGroupLeft(e,"thou","thousand.png",h);this.animationManager.fadeIn(i,.3);let s=setTimeout(()=>{let o=i.querySelectorAll("img.thou-carry"),n=document.querySelector('.num-box[data-place="thousands-result"]');if(n&&o.length>0?(this.renderer.prepareMergedAndAppend(n,o),this.animationManager.animateModelMovement("hundreds-result","thousands-result"),setTimeout(()=>{this.updateNumModelCount(n,"thousands"),this.renderer.appendMerged(e,"hundreds",c),this.renderer.removeMergedOnly(e);let t=this.renderer.getGroup(e,"merged");t&&this.renderer.stackGroupImagesCentered(t),this.updateNumModelCountForRemaining(e,"hundreds",c)},100)):o.forEach(e=>e.remove()),i&&i.remove(),this.renderer.removeMergedOnly(e),this.hundredsCarryCount=0,this.updateNumModelCountForRemaining(e,t,c),"+"===this.inputManager.getSelectedOperator()){let t=this.getCalculationResult(),r=this.getDigitAtPlace(t,"hundreds");this.renderer.updateNumModelCount(e,r)}r&&r(),this.animationTimeouts=this.animationTimeouts.filter(e=>e!==s)},1500);this.animationTimeouts.push(s);return}let g=0;g="tens"===t?l:"hundreds"===t?o:n,this.renderer.appendMerged(e,t,g),this.renderer.removeMergedOnly(e);let p=e.querySelector(".group-left"),m=e.querySelector(".group-right");p&&p.remove(),m&&m.remove(),this.renderer.removeEmptyGroups(e),this.updateNumModelCountForCurrentState(e,t),r&&r()}updateNumModelCount(e,t){if("+"===this.inputManager.getSelectedOperator()){let r=this.getCalculationResult(),i=this.getDigitAtPlace(r,t);if(i<=0)if(this.shouldHideZeroForPlace(r,t)){let t=e.querySelector(".num-model-count");t&&t.remove()}else this.renderer.updateNumModelCountZero(e);else this.renderer.updateNumModelCount(e,i);return}let r=e.querySelectorAll("img.num-model-img").length;0!==r&&this.renderer.updateNumModelCount(e,r)}updateNumModelCountForCurrentState(e,t){let r=0,i=0;"tens"===t?i=this.tensCarryCount:"hundreds"===t&&(i=this.hundredsCarryCount);let s=this.inputManager.getNumberFromDisplays("left"),o=this.inputManager.getNumberFromDisplays("right"),n=this.uiManager.getProgressState();if(n.clicked[t].left&&(r+=this.getDigitAtPlace(s,t)),n.clicked[t].right&&(r+=this.getDigitAtPlace(o,t)),(r+=i)<=0){if("+"===this.inputManager.getSelectedOperator()){let r=this.getCalculationResult();if(this.shouldHideZeroForPlace(r,t)){let t=e.querySelector(".num-model-count");t&&t.remove();return}}this.renderer.updateNumModelCountZero(e);return}this.renderer.updateNumModelCount(e,r)}updateNumModelCountForRemaining(e,t,r){if("+"===this.inputManager.getSelectedOperator()){if(r<=0){let r=this.getCalculationResult();if(this.shouldHideZeroForPlace(r,t)){let t=e.querySelector(".num-model-count");t&&t.remove();return}this.renderer.updateNumModelCountZero(e);return}this.renderer.updateNumModelCount(e,r);return}let i=e.querySelector(".num-model-count");if(i&&i.remove(),0===r){this.renderer.clearAllGroupsAndImages(e),this.renderer.updateNumModelCountZero(e);return}this.renderer.updateNumModelCount(e,r)}updateNumModelCountWithTotal(e,t){let r=0,i=0;"tens"===t?i=this.tensCarryCount:"hundreds"===t&&(i=this.hundredsCarryCount);let s=this.inputManager.getNumberFromDisplays("left"),o=this.inputManager.getNumberFromDisplays("right"),n=this.uiManager.getProgressState();if(n.clicked[t].left&&(r+=this.getDigitAtPlace(s,t)),n.clicked[t].right&&(r+=this.getDigitAtPlace(o,t)),r+=i,"+"===this.inputManager.getSelectedOperator()){let r=this.getCalculationResult(),i=this.getDigitAtPlace(r,t);if(i<=0)if(this.shouldHideZeroForPlace(r,t)){let t=e.querySelector(".num-model-count");t&&t.remove()}else this.renderer.updateNumModelCountZero(e);else this.renderer.updateNumModelCount(e,i)}else{if(r<=0)return void this.renderer.updateNumModelCountZero(e);this.renderer.updateNumModelCount(e,r)}}getMaxCalculationPlace(){let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right"),r=this.inputManager.getSelectedOperator();return this.calculationManager.getMaxCalculationPlace(e,t,r)}clearAllHighlights(){this.uiManager.clearAllHighlights()}async autoCalculateAll(){let e=this.getAutoCalculator();await e.start()}async animatePlaceValue(e){let t=this.getAutoCalculator();await t.animatePlaceValue.call(t,e)}getAutoCalculator(){if(this._autoCalculator)return this._autoCalculator;let e=this;return this._autoCalculator=new R({state:this.state,uiManager:this.uiManager,resultManager:this.resultManager,handGuide:this.handGuide,userInputManager:this.userInputManager,getMaxCalculationPlace:()=>e.getMaxCalculationPlace(),resetResultScreenWithoutHandGuide:()=>e.resetResultScreenWithoutHandGuide(),handleResultBoxClickAsync:(t,r,i)=>e.handleResultBoxClickAsync(t,r,i),showCalculationResultPopup:()=>e.showCalculationResultPopup(),getNextPlace:t=>e.getNextPlace(t),highlightCurrentNumBox:()=>e.highlightCurrentNumBox(),getBorrowToPlace:t=>e.getBorrowToPlace(t),checkBorrowNeeded:t=>e.checkBorrowNeeded(t),findNearestBorrowablePlace:t=>e.findNearestBorrowablePlace(t),autoPerformBorrow:async t=>{if(!e.isAutoCalculating)return;let r=document.querySelector(`.num-box[data-place="${t}-result"]`);if(r&&r.querySelectorAll(".num-model-img").length>0){if(await new Promise(e=>setTimeout(e,200)),!e.isAutoCalculating)return}else if(!e.isAutoCalculating||(e.placeNumModelInCalcContainerForSubtraction(t,"left"),await new Promise(e=>setTimeout(e,350)),!e.isAutoCalculating))return;e.clearResultImageContainer(t,"left");let i=e.getBorrowToPlace(t);if(!e.isAutoCalculating)return;if("hundreds"===t&&"tens"===i){let t=document.querySelector('.num-box[data-place="tens-result"]');t&&t.querySelector(".num-model-count")||e.placeNumModelInCalcContainerForSubtraction("tens","left")}if(!e.isAutoCalculating)return;e.showBorrowUI(t);let s=r??document.querySelector(`.num-box[data-place="${t}-result"]`),o=null==s?void 0:s.querySelector(".num-model-img.borrowable");if(o||(o=null==s?void 0:s.querySelector(".num-model-img")),e.isAutoCalculating&&o){if(await new Promise(e=>setTimeout(e,1200)),!e.isAutoCalculating)return;await e.executeBorrowAnimation(t,o)}},placeNumModelInCalcContainer:(t,r)=>e.placeNumModelInCalcContainer(t,r),placeNumModelInCalcContainerForSubtraction:(t,r)=>e.placeNumModelInCalcContainerForSubtraction(t,r),applySubtractionVisualEffect:(t,r)=>e.applySubtractionVisualEffect(t,r),addGlobalClickBlocker:t=>{e.preventClickHandler=t,document.addEventListener("click",t,!0)},isSubtractionOperator:()=>"-"===e.inputManager.getSelectedOperator()}),this._autoCalculator}handleResultBoxClickAsync(e,t,r){return new Promise(e=>{let i=p[r],s=0===t?"left":"right";if(!this.isAutoCalculating&&!this.isAnimating||!this.isAutoCalculating&&this.isAnimating)return e();let o=this.uiManager.getProgressState();if(i!==o.currentPlace||o.clicked[i][s])return e();this.uiManager.setClickedState(i,s,!0),this.clearResultImageContainer(i,s);let n=this.inputManager.getSelectedOperator();if("-"===n?"left"===s?this.placeNumModelInCalcContainerForSubtraction(i,s):"right"===s&&this.applySubtractionVisualEffect(i,s):this.placeNumModelInCalcContainer(i,s),this.uiManager.setButtonState(".btn-result-reset",!0),this.uiManager.getProgressState().clicked[i].left&&this.uiManager.getProgressState().clicked[i].right){let t=this.getNextPlace(i);if(t)if(this.state.startAnimating(),"-"===n){let r=setTimeout(()=>{this.mergeNumModelGroupsForSubtraction(i,()=>{this.uiManager.setCurrentPlace(t),this.highlightCurrentNumBox(),this.state.stopAnimating(),e()}),this.animationTimeouts=this.animationTimeouts.filter(e=>e!==r)},1e3);this.animationTimeouts.push(r)}else{let r=setTimeout(()=>{if(!this.isAutoCalculating&&!this.isAnimating)return void e();let s=document.querySelector(`.num-box[data-place="${i}-result"]`);s?this.mergeNumModelGroups(s,i,()=>{this.uiManager.setCurrentPlace(t),this.highlightCurrentNumBox(),this.state.stopAnimating(),e()}):e(),this.animationTimeouts=this.animationTimeouts.filter(e=>e!==r)},2e3);this.animationTimeouts.push(r)}else e()}else e()})}initializeHandGuide(){this.handGuide.setAutoCalculating(!1),this.handGuide.hide();let e=this.inputManager.getSelectedOperator();"-"===e?this.updateExpectedTargetMarker():document.querySelectorAll(".expected-target").forEach(e=>e.classList.remove("expected-target"));let t="-"===e?this.getNextGuideTargetElement():this.getNextGuideDigitBox();if(t){let r=setTimeout(()=>{let i=this.getHandGuidePosition(t),s=this.uiManager.getCurrentPlace();this.uiManager.getProgressState().clicked[s].left,this.handGuide.guideOnce(i.x,i.y).then(()=>{let e=document.querySelector(".result-screen");e&&this.userInputManager.start(e)});let o=this.uiManager.getCurrentPlace(),n=this.uiManager.getProgressState();if(!("-"===e&&n.clicked[o].left&&n.clicked[o].right)){let e=t.closest(".digit-result-box");this.uiManager.setActiveDigitResultBox(e)}this.animationTimeouts=this.animationTimeouts.filter(e=>e!==r)},100);this.animationTimeouts.push(r)}}startAutoHandGuide(){}showHandGuideForCurrentPlace(){this.uiManager.getCurrentPlace();let e=this.inputManager.getSelectedOperator(),t="-"===e?this.getNextGuideTargetElement():this.getNextGuideDigitBox();if(t){"-"===e?this.markExpectedTarget(t):document.querySelectorAll(".expected-target").forEach(e=>e.classList.remove("expected-target"));let r=this.getHandGuidePosition(t);this.handGuide.guideTwice(r.x,r.y);let i=this.uiManager.getCurrentPlace(),s=this.uiManager.getProgressState();if(!("-"===e&&s.clicked[i].left&&s.clicked[i].right)){let e=t.closest(".digit-result-box");this.uiManager.setActiveDigitResultBox(e)}}}handleWrongClick(){"-"===this.inputManager.getSelectedOperator()?this.updateExpectedTargetMarker():document.querySelectorAll(".expected-target").forEach(e=>e.classList.remove("expected-target")),this.showHandGuideForCurrentPlace()}handleCorrectClick(){this.handGuide.hide(),this.userInputManager.reset()}setupResultScreenClickDetection(){}getHandGuidePosition(e){return this.uiManager.getHandGuidePosition(e)}clearResultImageContainer(e,t){let r=document.querySelectorAll(".result-box")[+("left"!==t)];if(!r)return;let i=r.querySelectorAll(".digit-result-box")[({hundreds:0,tens:1,ones:2})[e]??0];if(!i)return;let s=i.querySelector(".result-image-container");s&&(s.innerHTML="")}getCurrentPlaceDigitBox(){return this.uiManager.getCurrentPlaceDigitBox()}getNextGuideDigitBox(){return this.uiManager.getNextGuideDigitBox()}getDigitResultBox(e,t){let r=document.querySelectorAll(".result-box")[+("left"!==t)];return r?r.querySelectorAll(".digit-result-box")[({hundreds:0,tens:1,ones:2})[e]??0]||null:null}setInitialPlaceForSubtractionStart(e,t){let r=Math.floor(e%100/10),i=Math.floor(t%100/10),s=Math.floor(e/100),o=Math.floor(t/100);if(0==e%10&&0==t%10){if(0!==r||0!==i)return void this.uiManager.setCurrentPlace("tens");else if(s>0||o>0)return void this.uiManager.setCurrentPlace("hundreds")}}getNextGuideTargetElement(){let e=this.inputManager.getSelectedOperator(),t={hundreds:0,tens:1,ones:2},r=(e,r)=>{let i=document.querySelectorAll(".result-box")[+("left"!==r)];return i?i.querySelectorAll(".digit-result-box")[t[e]??0]||null:null};if("-"===e){let e=this.uiManager.getCurrentPlace(),t=this.uiManager.getProgressState();if("tens"===e&&t.clicked.ones.left&&t.clicked.ones.right&&this.borrowedPlaces.has("tens")&&this.borrowedPlaces.has("ones")){let e=r("tens","right");if(e)return e}if("tens"===e&&t.clicked.ones.left&&t.clicked.ones.right&&!this.isInBorrowProcess&&!this.isWaitingForBorrow&&(this.borrowedPlaces.has("ones")||(this.state.getBorrowedCountsRecord().tens||0)>=10)){if(this.checkBorrowNeeded("tens")){let e=this.findBorrowablePlace("tens");if(e){let t=document.querySelector(`.num-box[data-place="${e}-result"]`),r=null==t?void 0:t.querySelector(".borrowable");if(r)return r;let i=document.querySelectorAll(".result-box")[0];if(i){let t=i.querySelectorAll(".digit-result-box")[({hundreds:0,tens:1,ones:2})[e]??0]||null;if(t)return t}}}let e=r("tens","right");if(e)return e}if(this.isInBorrowProcess||this.isWaitingForBorrow){let e=this.borrowFromPlace;if(e){let t=document.querySelector(`.num-box[data-place="${e}-result"]`),i=null==t?void 0:t.querySelector(".borrowable");if(i)return i;if(!this.uiManager.getProgressState().clicked[e].left){let t=r(e,"left");if(t)return t}}}if(!t.clicked[e].left){if("tens"===e&&t.clicked.ones.left&&t.clicked.ones.right&&!this.isInBorrowProcess&&!this.isWaitingForBorrow&&(this.borrowedPlaces.has("ones")||(this.state.getBorrowedCountsRecord().tens||0)>=10)){let e=r("tens","right");if(e)return e}if((e=>{let t=document.querySelector(`.num-box[data-place="${e}-result"]`),r=!!(null==t?void 0:t.querySelector(".num-model-group.group-left")),i=!!(null==t?void 0:t.querySelector(".num-model-count"));return r||i})(e)&&!this.checkBorrowNeeded(e)){let t=r(e,"right");if(t)return t}if(this.checkBorrowNeeded(e)){let t=this.findBorrowablePlace(e);if(t){let e=document.querySelector(`.num-box[data-place="${t}-result"]`),r=null==e?void 0:e.querySelector(".borrowable");if(r)return r}}let i=r(e,"left");if(i)return i}if(t.clicked[e].left&&!t.clicked[e].right){if(this.checkBorrowNeeded(e)){let t=this.findBorrowablePlace(e);if(t){let e=document.querySelector(`.num-box[data-place="${t}-result"]`),i=null==e?void 0:e.querySelector(".borrowable");if(i)return i;let s=r(t,"left");if(s)return s}}if("tens"===e&&!this.isInBorrowProcess&&!this.isWaitingForBorrow&&(this.borrowedPlaces.has("ones")||(this.state.getBorrowedCountsRecord().tens||0)>=10)&&t.clicked.ones.left&&t.clicked.ones.right){let e=r("tens","right");if(e)return e}let i=r(e,"right");if(i)return i}}return this.getNextGuideDigitBox()}updateExpectedTargetMarker(){let e=this.inputManager.getSelectedOperator();if(document.querySelectorAll(".expected-target").forEach(e=>e.classList.remove("expected-target")),"-"===e){let e=this.getNextGuideTargetElement();e&&this.markExpectedTarget(e)}}markExpectedTarget(e){document.querySelectorAll(".expected-target").forEach(e=>e.classList.remove("expected-target")),e.classList.add("expected-target")}async autoCalcOnesOnly(){if(this.isAnimating)return;this.state.stopAnimating(),this.uiManager.setCurrentPlace("ones"),this.uiManager.resetClickedStates();let e="ones";for(let t=0;t<2;t++){let r=0===t?"left":"right";if(this.uiManager.getProgressState().clicked[e][r])continue;let i=`.digit-result[data-place="${e}-result"]`,s=document.querySelectorAll(i)[t];if(0===(s?parseInt(s.textContent||"0",10):0))continue;let o=document.querySelectorAll(".result-box")[t].querySelectorAll(".digit-result-box"),n=o[o.length-1-0];n&&await this.handleResultBoxClickAsync(n,t,0)}this.state.stopAnimating()}closeCalculationResultPopup(){this.popupManager.closeCalculationResultPopup()}showCalculationResultPopup(){if(!1===this.isCalculationComplete||!this.isAutoCalculating&&!this.isCalculationComplete)return;let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right"),r=this.getCalculationResult(),i=this.inputManager.getSelectedOperator();if("+"===i)this.updateAllPlacesForAddition();else if("-"===i){this.updateAllPlacesForSubtraction();let r=e-t;["hundreds","tens"].forEach(e=>{var t;let i=document.querySelector(`.num-box[data-place="${e}-result"]`);if(!i)return;let s=i.querySelector(".num-model-count");s&&(null==(t=s.textContent)?void 0:t.trim())==="0"&&this.shouldHideZeroForPlace(r,e)&&s.remove()})}this.clearAllHighlights(),this.uiManager.deactivateAllDigitResultBoxesHighlight();let s=`${e}${i}${t}=${r}`;this.popupManager.showCalculationResultPopup(s)}getDigitAtPlace(e,t){return m(e,t)}changeToRedImage(e,t){k(e,t)}changeToOriginalImage(e,t){let r=e.src;r.includes("one_r.png")?e.src=r.replace("one_r.png","one.png"):r.includes("ten_r.png")?e.src=r.replace("ten_r.png","ten.png"):r.includes("hun_r.png")?e.src=r.replace("hun_r.png","hun.png"):r.includes("thousand_r.png")&&(e.src=r.replace("thousand_r.png","thousand.png"))}placeNumModelInCalcContainerForSubtraction(e,t){this.getSubtractionFlow().placeLeftGroup(e)}applySubtractionVisualEffect(e,t){this.getSubtractionFlow().applyVisual(e)}mergeNumModelGroupsForSubtraction(e,t){this.getSubtractionFlow().mergeGroups(e,t)}updateNumModelCountForSubtraction(e,t,r){let i=this.inputManager.getNumberFromDisplays("left")-this.inputManager.getNumberFromDisplays("right");this.renderer.updateSubtractionCount(e,t,r,e=>this.shouldHideZeroForPlace(i,e))}updateAllPlacesForSubtraction(){this.getSubtractionFlow().updateAllPlaces()}updateAllPlacesForAddition(){let e=this.inputManager.getNumberFromDisplays("left")+this.inputManager.getNumberFromDisplays("right");for(let t of["ones","tens","hundreds"]){let r=document.querySelector(`.num-box[data-place="${t}-result"]`);if(!r)continue;let i=this.getDigitAtPlace(e,t);if(i<=0)if(this.shouldHideZeroForPlace(e,t)){let e=r.querySelector(".num-model-count");e&&e.remove()}else this.renderer.updateNumModelCountZero(r);else this.renderer.updateNumModelCount(r,i)}}shouldHideZeroForPlace(e,t){return C(e,t)}isSubtractionCalculationComplete(){return this.getSubtractionFlow().isCalculationComplete()}getSubtractionFlow(){if(this._subtractionFlow)return this._subtractionFlow;let e=this;return this._subtractionFlow=new D({inputManager:this.inputManager,calculationManager:this.calculationManager,renderer:this.renderer,effects:{runSubtractionHighlightAndFade:B},logic:{computeSubtractionDigitForPlace:v},state:{get isAutoCalculating(){return e.isAutoCalculating},get isCalculationComplete(){return e.isCalculationComplete}},borrowedPlaces:this.borrowedPlaces,buildBorrowedCounts:()=>this.buildBorrowedCounts()}),this._subtractionFlow}checkBorrowNeeded(e){let t=this.inputManager.getNumberFromDisplays("left");return b(t,this.inputManager.getNumberFromDisplays("right"),e,this.buildBorrowedCounts(),this.borrowedPlaces)}checkBorrowNeededForLowerPlace(e){let t=["ones","tens","hundreds"],r=t.indexOf(e);for(let e=0;e<r;e++){let r=t[e];if(this.checkBorrowNeeded(r))return!0}return!1}findBorrowablePlace(e){return M(this.inputManager.getNumberFromDisplays("left"),e,this.state.getBorrowedCountsRecord())}isTwoStepBorrowScenario(){let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right");return!(e<=t)&&0==e%100&&99==t%100}findNearestBorrowablePlace(e){return M(this.inputManager.getNumberFromDisplays("left"),e,this.state.getBorrowedCountsRecord())}getBorrowToPlace(e){return w(e)}getActualAvailableCount(e){return S(this.inputManager.getNumberFromDisplays("left"),e,this.state.getBorrowedCountsRecord())}showBorrowUI(e){this.getBorrowController().showBorrowUI(e),setTimeout(()=>{this.showHandGuideForCurrentPlace()},80)}handleBorrowClick(e,t){setTimeout(()=>void this.executeBorrowAnimation(e,t),100)}async executeBorrowAnimation(e,t){let r=this.uiManager.getCurrentPlace(),i=this.getBorrowController(),s=await i.handleBorrowClick(e,t);if(!s)return;let{to:o,totalImages:n,wasBorrowedPlace:a}=s,l=this.numBoxFor(o);if(l&&this.updateNumModelCountForSubtraction(l,o,n),"tens"===o){let e=this.numBoxFor("tens");e&&this.renderer.updateSubtractionCount(e,"tens",n,e=>!1)}if(this.clearResultImageContainer(o,"left"),this.uiManager.getProgressState().clicked[o].left||this.uiManager.setClickedState(o,"left",!0),"tens"===e||"hundreds"===e){let t=document.querySelector(`.num-box[data-place="${e}-result"]`);if(t)if(a)this.renderer.rebuildBorrowFromBox(t,e,9);else{let r=this.inputManager.getNumberFromDisplays("left"),i=Math.max(this.getDigitAtPlace(r,e)-1,0);this.renderer.rebuildBorrowFromBox(t,e,i)}}this.borrowedPlaces.add(o),this.isWaitingForBorrow=!1,this.isTwoStepBorrowScenario&&this.isTwoStepBorrowScenario()&&(this.uiManager.setCurrentPlace(r),this.highlightCurrentNumBox()),this.state.endBorrowProcess(),this.updateExpectedTargetMarker(),this.highlightCurrentNumBox()}getBorrowController(){if(this._borrowController)return this._borrowController;let e=this;return this._borrowController=new O({state:{startBorrowProcess:e=>this.state.startBorrowProcess(e),endBorrowProcess:()=>this.state.endBorrowProcess(),get isInBorrowProcess(){return e.isInBorrowProcess},get isWaitingForBorrow(){return e.isWaitingForBorrow}},uiManager:{setClickedState:(e,t,r)=>this.uiManager.setClickedState(e,t,r)},borrowUI:{showBorrowUI:e=>this.borrowUI.showBorrowUI(e)},renderer:{rebuildBorrowFromBox:(e,t,r)=>this.renderer.rebuildBorrowFromBox(e,t,r)},helpers:{numBoxFor:e=>this.numBoxFor(e),ensureGroup:(e,t,r)=>this.ensureGroup(e,t,r),splitGroupsAndDistribute:(e,t,r,i,s,o,n)=>this.splitGroupsAndDistribute(e,t,r,i,s,o,n),appendImagesToGroup:(e,t,r,i,s)=>this.appendImagesToGroup(e,t,r,i,s)},logic:{applyBorrow:(e,t)=>(function(e,t){let r=w(t);if(!r)return{updatedBorrowedCounts:{...e},to:null};let i={...e};return i[r]=(i[r]??0)+10,{updatedBorrowedCounts:i,to:r}})(e,t),findBorrowablePlace:(e,t,r)=>M(e,t,r),needsBorrow:(e,t,r,i)=>b(e,t,r,i)},accessors:{getLeftNumber:()=>this.inputManager.getNumberFromDisplays("left"),getRightNumber:()=>this.inputManager.getNumberFromDisplays("right"),getBorrowedCountsRecord:()=>this.state.getBorrowedCountsRecord(),setBorrowCount:(e,t)=>this.borrowCounts.set(e,t),isBorrowedPlace:e=>this.borrowedPlaces.has(e)}}),this._borrowController}createMissingPlaceImages(e,t){let r=["ones","tens","hundreds"],i=r.indexOf(e),s=r.indexOf(t);for(let e=i+1;e<s;e++){let t=r[e];this.uiManager.getProgressState().clicked[t].left||(this.placeNumModelInCalcContainerForSubtraction(t,"left"),this.uiManager.setClickedState(t,"left",!0))}}checkRemainingCalculation(e){return function(e,t,r,i){let s=["ones","tens","hundreds"],o=Math.floor(t/100),n=Math.floor(r/100),a=Math.floor(r%100/10),l="ones";(Math.floor(t%100/10)>0||a>0)&&(l="tens"),(o>0||n>0)&&(l="hundreds");let u=s.indexOf(l),c=s.indexOf(e);for(let e=c;e<=u;e++)if(m(r,s[e])>0)return!0;return!1}(e,this.inputManager.getNumberFromDisplays("left"),this.inputManager.getNumberFromDisplays("right"),this.borrowedPlaces)}getCalculationResult(){let e=this.inputManager.getNumberFromDisplays("left"),t=this.inputManager.getNumberFromDisplays("right"),r=this.inputManager.getSelectedOperator();return this.calculationManager.getCalculationResult(e,t,r)}constructor(e){super(e),(0,i._)(this,"tensCarryCount",0),(0,i._)(this,"hundredsCarryCount",0),(0,i._)(this,"state",new x),(0,i._)(this,"renderer",new P),(0,i._)(this,"popupManager",new E),(0,i._)(this,"borrowUI",new T({onBorrowImageClick:(e,t)=>this.handleBorrowClick(e,t)})),(0,i._)(this,"animationTimeouts",[]),(0,i._)(this,"preventClickHandler",null),(0,i._)(this,"handGuide",void 0),(0,i._)(this,"userInputManager",void 0),(0,i._)(this,"inputManager",void 0),(0,i._)(this,"calculationManager",void 0),(0,i._)(this,"animationManager",void 0),(0,i._)(this,"uiManager",void 0),(0,i._)(this,"resultManager",void 0),(0,i._)(this,"_subtractionFlow",void 0),(0,i._)(this,"_borrowController",void 0),(0,i._)(this,"_autoCalculator",void 0);let t=document.querySelector("#wrap");this.handGuide=new A(t||document.body,{initialShowDuration:1e3,clickAnimationDelay:400,clickHoldDuration:500,clickReleaseDelay:500,betweenClicksDelay:300}),this.handGuide.setAnimationCompleteCallback(()=>{this.userInputManager.restartAutoGuideTimer()}),this.userInputManager=new N({correctSelectors:[".digit-result-box"],excludeSelectors:[".btn-auto-calc",".btn-result-reset",".btn-home","header .home-box .home","header .title-box"],autoGuideDelay:5e3,wrongClickThreshold:2}),this.userInputManager.setEventHandlers(()=>this.handleWrongClick(),()=>this.handleCorrectClick(),()=>this.showHandGuideForCurrentPlace()),this.inputManager=new I({onOperatorChange:e=>{},onCalculate:()=>{this.calculate()},onReset:()=>{this.reset()},onPlaceImages:(e,t,r)=>{this.inputManager.placeImages(e,t,r)}}),this.calculationManager=new F({onShowModal:e=>{this.showModal(e)},onShowResultScreen:(e,t,r)=>{this.showResultScreen(e,t,r)},inputManager:this.inputManager}),this.animationManager=new G({onAnimationComplete:()=>{},onStepComplete:e=>{}}),this.uiManager=new _({onPlaceChange:e=>{this.highlightCurrentNumBox(),this.updateExpectedTargetMarker()},onStateChange:e=>{let t=this.inputManager.getSelectedOperator(),r=this.uiManager.getCurrentPlace(),i=this.uiManager.getProgressState();if(!("-"===t&&i.clicked[r].left&&i.clicked[r].right)){var s;this.updateExpectedTargetMarker();let e="-"===t?this.getNextGuideTargetElement():this.getNextGuideDigitBox(),r=(null==e||null==(s=e.closest)?void 0:s.call(e,".digit-result-box"))||null;if(!r&&"-"===t&&(this.isInBorrowProcess||this.isWaitingForBorrow)){let e=this.borrowFromPlace;e&&(r=this.getDigitResultBox(e,"left"))}this.uiManager.setActiveDigitResultBox(r)}}}),this.resultManager=new L({onResultBoxClick:(e,t,r)=>{this.handleResultBoxClick(e,t,r)}},this.renderer),this.uiManager.bindResultScreenButtons({onAutoCalc:()=>{this.isAutoCalculating||this.isAnimating||this.autoCalculateAll()},onReset:()=>{this.closeCalculationResultPopup(),this.state.resetCalcFlags(),this.state.stopAnimating(),this.state.resetBorrowState(),this.isCalculationComplete=!1,this.resetResultScreen()},onHome:()=>{this.closeCalculationResultPopup(),this.state.resetCalcFlags(),this.state.stopAnimating(),this.goToHome()}})}}let H=new class{setupInit(e){this.initPage=e}noDelay(){this.isNoDelay=!0}init(){this.initButtonHover(),this.initScale(),o.add([{id:"button",src:u,ignoreStop:!0}]),this.isNoDelay?this.showContent():this.tioShow=setTimeout(()=>{this.showContent()},1e3)}initButtonHover(){var e;(Array.isArray(e=Array.from(new Set([...Array.from(document.querySelectorAll('*[class*="btn"]:not([class*="btns"])')),...Array.from(document.querySelectorAll("button"))])))?e:[e]).forEach(e=>{e.addEventListener("pointerenter",t=>{"touch"!==(t.pointerType||"touch")&&e.classList.add("hover")}),e.addEventListener("pointerleave",t=>{"touch"!==(t.pointerType||"touch")&&e.classList.remove("hover")})})}showContent(){if(this.root&&this.root.classList.remove("hidden"),this.tioShow&&clearTimeout(this.tioShow),1===this.pages.length){let e=this.pages[0];e.init(),e.activate()}else for(let e of this.pages)e.init();a(window,{message:"CONTENT_READY"})}hnMessage(e){let t=e.detail;!function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r]}("hnMessage :: ",t.message),t.message}initScale(){this.resize&&(this.setScale(),window.addEventListener("resize",()=>{this.setScale()}),window.addEventListener("orientationchange",()=>{setTimeout(()=>{this.setScale()},1e3)}))}setScale(){this.root&&(window.bound=function(e,t,r){let i=Math.min(window.innerWidth/1280,window.innerHeight/720),s=(window.innerWidth-1280*i)/2,o=(window.innerHeight-720*i)/2;return e.style.transformOrigin="top left",e.style.left=`${s}px`,e.style.top=`${o}px`,e.style.transform=`scale(${i})`,{x:s,y:o,scale:i}}(this.root,1280,720),a(window,{message:"CONTENT_RESIZE"}))}constructor(e){for(let t of((0,i._)(this,"props",void 0),(0,i._)(this,"resize",void 0),(0,i._)(this,"root",void 0),(0,i._)(this,"pages",[]),(0,i._)(this,"initPage",void 0),(0,i._)(this,"tioShow",void 0),(0,i._)(this,"isNoDelay",!1),(0,i._)(this,"messageHandler",void 0),this.props=e??{},this.resize=this.props.resize??!0,window.oncontextmenu=e=>(e.preventDefault(),e.stopPropagation(),!1),this.root=document.querySelector("#wrap"),Array.from(document.querySelectorAll("img"))))t.draggable=!1;window.addEventListener("load",()=>{this.pages=this.initPage(),this.init()}),this.messageHandler=this.hnMessage.bind(this),window.addEventListener("MESSAGE",this.messageHandler)}};H.noDelay(),H.setupInit(function(){return[new $({root:".root"})]})}},t={};function r(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.m=e,r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=[];r.O=(t,i,s,o)=>{if(i){o=o||0;for(var n=e.length;n>0&&e[n-1][2]>o;n--)e[n]=e[n-1];e[n]=[i,s,o];return}for(var a=1/0,n=0;n<e.length;n++){for(var[i,s,o]=e[n],l=!0,u=0;u<i.length;u++)(!1&o||a>=o)&&Object.keys(r.O).every(e=>r.O[e](i[u]))?i.splice(u--,1):(l=!1,o<a&&(a=o));if(l){e.splice(n--,1);var c=s();void 0!==c&&(t=c)}}return t}})(),r.rv=()=>"1.3.8",(()=>{r.g.importScripts&&(e=r.g.location+"");var e,t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var s=i.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=i[s--].src}if(!e)throw Error("Automatic publicPath is not supported in this browser");r.p=(e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"))+"../"})(),(()=>{var e={980:0};r.O.j=t=>0===e[t];var t=(t,i)=>{var s,o,[n,a,l]=i,u=0;if(n.some(t=>0!==e[t])){for(s in a)r.o(a,s)&&(r.m[s]=a[s]);if(l)var c=l(r)}for(t&&t(i);u<n.length;u++)o=n[u],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(c)},i=self.webpackChunkamanta_2025_project=self.webpackChunkamanta_2025_project||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),r.ruid="bundler=rspack@1.3.8";var i=r.O(void 0,["971"],function(){return r(572)});i=r.O(i)})();